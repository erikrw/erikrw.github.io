<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Erik Ramsgaard Wognsen]]></title>
  <link href="http://blog.erw.dk/atom.xml" rel="self"/>
  <link href="http://blog.erw.dk/"/>
  <updated>2015-07-29T14:52:04+02:00</updated>
  <id>http://blog.erw.dk/</id>
  <author>
    <name><![CDATA[Erik Ramsgaard Wognsen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ode to my Casio]]></title>
    <link href="http://blog.erw.dk/2015/07/11/ode-to-my-casio/"/>
    <updated>2015-07-11T13:57:20+02:00</updated>
    <id>http://blog.erw.dk/2015/07/11/ode-to-my-casio</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://blog.erw.dk/images/posts/casio.jpg" width="345"></p>

<p>The year was 2002 and I had started gymnasium (≈high school). My parents had
bought me the graphic calculator required for our maths classes: Casio fx-9750G
PLUS. It was white and green and curvy and Casio &mdash; not dark and rectangular
and from Texas Instruments, as a calculator was expected to be. Soon, however,
this happy-looking thing became my companion on my journey into the world of
programming.</p>

<!-- more -->


<p>Compared with a personal computer, this calculator was weak, to say the least.
The display resolution was 128×64 pixels in black and white. (However, I did
for a long time dream of the color LCD version CFX-9850GC PLUS, which could
show <em>three</em> colors:
<span style="color:orange">orange</span>,
<span style="color:green">green</span>, and
<span style="color:blue">blue</span>.)
The processor was slow. Graphing <em>y = x<sup>2</sup></em> took a good five seconds. Sinusoidal
regression on 150 data points took 75 seconds, plus another 8 seconds to draw
the sine curve.
Memory was limited as well: 32K, of which only 28568 bytes were available to
the user. And of which every list and matrix entry took up 10 bytes! Plus, any
time something was graphed, 4K was reserved for that.</p>

<p>Yet for all these complaints, this machine was a fantastic place to start
programming. Having a fixed set of features challenges you to do what you can
with what you have. On this fixed platform, there was no getting lost in
debates about which programming language to use, because there was only one
choice. There was no trouble with installation or incompatible software
libraries. There was no web browsing or multitasking. No distraction. And zero
boot time and a year of battery life.</p>

<p><img class="right" src="http://blog.erw.dk/images/posts/casio-fact.jpg"></p>

<p>The basic calculator part is a REPL: That is to say it <em>reads</em> your input,
<em>evaluates</em> it, <em>prints</em> the result, and it <em>loops</em>, doing this indefinitely.
In this interactive environment, you can familiarize yourself with expressions
before slowly, step by step, automating small parts of your calculations. You
could, for example, make a small program that asks the user for input and uses
a loop to do a calculation.</p>

<p>And there were enough features to do really cool things: Plotting, lists and
list operations (sorting, summation, product, mean, median, etc.), matrices and
matrix operations, statistics, regression, etc.</p>

<a name="Programming.on.the.Bus"></a>
<h2>Programming on the Bus</h2>

<p>During the bus trips to school I spent as much time with my Casio as people
today spend with their smartphones. And I suppose this puzzled the other
students: How much time can you really spend calculating?</p>

<p>I made programs for all sorts of tasks. One type was the programs that helped
my maths and science classes. In maths it was nice to be able to enter the
information you had about a triangle, and then calculate the rest
automatically. Or calculate the greatest common divisor. In physics,
I calculated and visualized refraction. In chemistry, I calculated molar
masses.</p>

<p><img class="right" src="http://blog.erw.dk/images/posts/casio-guitar.jpg"></p>

<p>But it was also fun and games: I made programs that drew nice geometric shapes
for their beauty. I calculated poker odds. During some boring classes I made
a program in which you entered the time of day (the calculator didn&rsquo;t have
a clock), and it drew a 3d pie chart showing how close the current lecture was
to completion. And I factored out the pie chart so other programs could use it
as a subroutine.</p>

<p>I made programs for sound and music. I translated between notes (such as A) and
frequencies (such as 440 Hz). I visualized harmonics. I made a program that
showed all the ways a chosen note could be played on a guitar. (And
I didn&rsquo;t even play the guitar!)</p>

<p>And I made games. Guess which number I&rsquo;m thinking of, where the program tells
you whether your guess was too high or too low. I made a game in which you had
to remember random numbers that were shown in progressively shorter glimpses.
Each level made the number one digit longer. I made Snake. It grew linearly
slower with the length of the snake, and the game was too slow to be fun to
play. But that didn&rsquo;t affect my pride in making it. Near the end of gymnasium,
I was planning a strategy game inspired by Command &amp; Conquer Tiberian Sun,
which I loved. I had a cool animation for the cyborgs&#8217; machine guns, but other
than that, I never got very far. But to be fair, it is a rather big step from
Snake to that.</p>

<a name="Much.Learnage"></a>
<h2>Much Learnage</h2>

<p>This primitive programming taught me some lessons about &ldquo;real&rdquo; programming:</p>

<ul>
<li>Understanding a program you wrote months ago is tricky, when all variable
names are a single character. I learned the value of descriptive variable
names.</li>
<li>The slow processor gave me a tangible sense of execution time and complexity.</li>
<li>With an editor window of 6x21 chars, I soon learned that sketching your
algorithm or architecture before implementing is useful for big programs.
That would probably take more time to learn on a big screen.</li>
<li>I learned to prioritize what to do with the limited memory.</li>
<li>I learned debugging the hard way: There were almost no meaningful error
messages (but at least you could be taken to the location in the code that
caused the error).</li>
<li>I learned that all programs and subroutines sharing a global address space
sucks!</li>
</ul>


<a name="Interacting.with.the.World"></a>
<h2>Interacting with the World</h2>

<p>After some time, interacting with a program through a (tiny) screen and (tiny)
keyboard was not enough. I wanted to interact with the world. Thankfully, my
parents got me the Casio EA-200 data logger. This device was even clunkier than
the calculator, but it was a window to the physical world: Now I could measure
voltage, light, temperature, and sound.</p>

<p>I measured the fluctuation of the temperature in the fridge. Since I could hear
the compressor swiching on and off I knew the temperature couldn&rsquo;t be constant,
so I wanted to know the extent of the lie that &ldquo;a fridge is 5&#x00b0;C&rdquo;. (As
I recall, it went between 4 and 8&#x00b0;C). Knowledge is power, even in the
small.</p>

<p>With the microphone and speaker, I made a dictaphone. As with Snake, the idea
of making it was more important than its usefulness. It did work, but the
memory was somewhat limited.</p>

<p>I also measured the fluctuation of the intensity of light from lightbulbs. Even
when they appear constantly on, they heat and cool with the alternating current
of the electric grid. And I learned about another &ldquo;truth&rdquo;: Our electric grid
runs at 50 Hz. Yes, when it&rsquo;s not 49 and 52 and 50.2 Hz. This is also where
I got to appreciate the Fourier transform that I recently <a href="http://blog.erw.dk/2015/03/20/debugging-complex-numbers/">implemented</a>
myself.</p>

<p>My dear Casio, thanks for the ride.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Checks for Your Django Project]]></title>
    <link href="http://blog.erw.dk/2015/06/06/checks-for-your-django-project/"/>
    <updated>2015-06-06T13:42:14+02:00</updated>
    <id>http://blog.erw.dk/2015/06/06/checks-for-your-django-project</id>
    <content type="html"><![CDATA[<p>The <a href="https://www.djangoproject.com/">Django web framework</a> has a management
command to <a href="https://docs.djangoproject.com/en/1.8/ref/checks/">check</a> your code for various problems. For
example, it checks that your database <code>CharFields</code> define the <code>max_length</code>
attribute, and that you have not set <code>DEBUG = True</code> in deployment. This is good
for catching various mistakes in using the framework before the problem shows
up in production. And for your own business logic, you have unit tests. But
there are still many things to not mess up, and they are easy to forget if they
are not incredibly easy to check. So I wrote a script to check every problem
I could think of in one go.</p>

<!-- more -->


<p>First up is the unit tests. For this script I only want it to tell me anything
if there is a problem, as is customary for unix programs. With verbosity 0 and
<code>head -n -4</code> cutting off the last four lines with the test summary, only failed
test cases are shown:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./manage.py <span class="nb">test</span> -v <span class="m">0</span> --noinput 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> head -n -4
</span></code></pre></td></tr></table></div></figure>


<p>Alternatively, you can run them with a code coverage check. Here, failed tests
are shown and the total code coverage is shown if it is below 50%:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>coverage run --branch --source<span class="o">=</span><span class="s1">&#39;.&#39;</span> --omit<span class="o">=</span><span class="s1">&#39;*/migrations/*,*test*,*settings*&#39;</span> <span class="se">\</span>
</span><span class='line'>    manage.py <span class="nb">test</span> -v <span class="m">0</span> 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> head -n -4
</span><span class='line'>coverage report --fail-under<span class="o">=</span><span class="m">50</span> &gt;/dev/null <span class="o">||</span> coverage report <span class="p">|</span> sed -n <span class="s1">&#39;1p;$p&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first of the &ldquo;hidden&rdquo; things that is easy to forget is changes to the data
model that need to be migrated in the database. Unfortunately, the
<code>makemigrations</code> management command doesn&rsquo;t have a usable exit status, but
I work around that to only output text in case of problems:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span> <span class="s2">&quot;$(./manage.py makemigrations --dry-run)&quot;</span> !<span class="o">=</span> <span class="s2">&quot;No changes detected&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    ./manage.py makemigrations --dry-run <span class="o">&amp;&amp;</span> <span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<p>I also run <a href="https://flake8.readthedocs.org/">flake8</a> which wraps the code style checker <a href="http://pep8.readthedocs.org/en/latest/intro.html">pep8</a>,
the static error checker <a href="https://pypi.python.org/pypi/pyflakes">Pyflakes</a>, and, optionally,
the <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity">code complexity</a> checker <a href="https://pypi.python.org/pypi/mccabe">mccabe</a>, if
you give the flag <code>--max-complexity=10</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>flake8 . <span class="o">||</span> <span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Translation"></a>
<h2>Translation</h2>

<p>For a multilingual project, you must remember to scan for changes to
translatable strings and also to translate them. The <code>makemessages</code> management
command goes over the source and finds all strings marked for translation and
makes or updates the translation &ldquo;portable object&rdquo;/PO file. So ideally, I could
just run that command and see if there are any changes to the PO file.</p>

<p>However, <code>makemessages</code> includes a timestamp for the generation of the file, so
it is always different each time the command is run. On top of that, it can
happen that the command finds the translatable strings in a different order
even when the content of the strings didn&rsquo;t change (I think this happens
between different version of Django).</p>

<p>So, I compare the before and after versions of the PO file with the timestamps
stripped out, and sorted such that ordering doesn&rsquo;t matter. This sorting trick
will cause false negatives if two strings are swapped in the source code, but
this seems unlikely and therefore preferable to getting false positives from
<code>makemessages</code>&#x2019; inability to search the source in a consistent order.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sed <span class="s1">&#39;/POT-Creation-Date/d&#39;</span> locale/da/LC_MESSAGES/django.po &gt; __po1
</span><span class='line'>mv locale/da/LC_MESSAGES/django.po<span class="o">{</span>,_orig<span class="o">}</span>
</span><span class='line'>cp locale/da/LC_MESSAGES/django.po<span class="o">{</span>_orig,<span class="o">}</span>
</span><span class='line'>./manage.py makemessages -v <span class="m">0</span> -a --no-location --no-obsolete
</span><span class='line'>sed <span class="s1">&#39;/POT-Creation-Date/d&#39;</span> locale/da/LC_MESSAGES/django.po &gt; __po2
</span><span class='line'>mv locale/da/LC_MESSAGES/django.po<span class="o">{</span>_orig,<span class="o">}</span>
</span><span class='line'>diff &lt;<span class="o">(</span>sort __po1<span class="o">)</span> &lt;<span class="o">(</span>sort __po2<span class="o">)</span> &gt;/dev/null <span class="o">||</span> <span class="se">\</span>
</span><span class='line'>    <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;=== Translation not up to date:&quot;</span> <span class="o">&amp;&amp;</span> diff __po1 __po2 <span class="o">||</span> <span class="nb">echo</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'>rm __po1 __po2
</span></code></pre></td></tr></table></div></figure>


<p>Before and after running <code>makemessages</code>, I backup the PO file and restore it,
respectively. By doing this as <code>mv A B; cp B A; mv B A</code>, rather than just <code>cp
A B; mv B A</code>, the file retains its inode. Thus, editors will not falsely see
the file as changed outside the editor.</p>

<p>Even if you had already run <code>makemessages</code>, you also had to translate the newly
found strings. I check for both untranslated strings and unverified automatic
translations. The former appear as <code>msgstr ""</code>, but not every <code>msgstr ""</code> means
you forgot a translation; some of them just mark the beginning of a string
spanning multiple lines. So I do some <code>sed</code> magic to find the real culprits:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sed <span class="s1">&#39;$a\\&#39;</span> locale/da/LC_MESSAGES/django.po <span class="p">|</span> tac <span class="p">|</span> <span class="se">\</span>
</span><span class='line'>    sed <span class="s1">&#39;/^$/N;/\nmsgstr &quot;&quot;$/,/^msgid/!d&#39;</span> <span class="p">|</span> tac
</span></code></pre></td></tr></table></div></figure>


<p>While scanning, if <code>makemessages</code> finds a string that is close to something you
already translated, it will insert the existing translation and mark it as
a &ldquo;fuzzy&rdquo; match, so you can check it and remove the fuzzy label when the
translation is done. I find such unremoved &ldquo;fuzzy&rdquo; labels:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span> <span class="k">$(</span>grep -c <span class="s1">&#39;, fuzzy&#39;</span> locale/da/LC_MESSAGES/django.po<span class="k">)</span> -gt <span class="m">1</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;=== Fuzzy translation:&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    grep <span class="s1">&#39;, fuzzy&#39;</span> locale/da/LC_MESSAGES/django.po -A2 <span class="p">|</span> tail -n +5 <span class="o">&amp;&amp;</span> <span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<a name="The.Full.Script"></a>
<h2>The Full Script</h2>

<p>With all the components of the script done, the whole script looks like this.
I call it <code>ok.sh</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>coverage run --branch --source<span class="o">=</span><span class="s1">&#39;.&#39;</span> --omit<span class="o">=</span><span class="s1">&#39;*/migrations/*,*test*,*settings*&#39;</span> <span class="se">\</span>
</span><span class='line'>    manage.py <span class="nb">test</span> -v <span class="m">0</span> 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> head -n -4
</span><span class='line'>coverage report --fail-under<span class="o">=</span><span class="m">50</span> &gt;/dev/null <span class="o">||</span> coverage report <span class="p">|</span> sed -n <span class="s1">&#39;1p;$p&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span> <span class="s2">&quot;$(./manage.py makemigrations --dry-run)&quot;</span> !<span class="o">=</span> <span class="s2">&quot;No changes detected&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    ./manage.py makemigrations --dry-run <span class="o">&amp;&amp;</span> <span class="nb">echo</span>
</span><span class='line'>
</span><span class='line'>flake8 . <span class="o">||</span> <span class="nb">echo</span>
</span><span class='line'>
</span><span class='line'>sed <span class="s1">&#39;/POT-Creation-Date/d&#39;</span> locale/da/LC_MESSAGES/django.po &gt; __po1
</span><span class='line'>mv locale/da/LC_MESSAGES/django.po<span class="o">{</span>,_orig<span class="o">}</span>
</span><span class='line'>cp locale/da/LC_MESSAGES/django.po<span class="o">{</span>_orig,<span class="o">}</span>
</span><span class='line'>./manage.py makemessages -v <span class="m">0</span> -a --no-location --no-obsolete
</span><span class='line'>sed <span class="s1">&#39;/POT-Creation-Date/d&#39;</span> locale/da/LC_MESSAGES/django.po &gt; __po2
</span><span class='line'>mv locale/da/LC_MESSAGES/django.po<span class="o">{</span>_orig,<span class="o">}</span>
</span><span class='line'>diff &lt;<span class="o">(</span>sort __po1<span class="o">)</span> &lt;<span class="o">(</span>sort __po2<span class="o">)</span> &gt;/dev/null <span class="o">||</span> <span class="se">\</span>
</span><span class='line'>    <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot;=== Translation not up to date:&quot;</span> <span class="o">&amp;&amp;</span> diff __po1 __po2 <span class="o">||</span> <span class="nb">echo</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'>rm __po1 __po2
</span><span class='line'>
</span><span class='line'>sed <span class="s1">&#39;$a\\&#39;</span> locale/da/LC_MESSAGES/django.po <span class="p">|</span> tac <span class="p">|</span> <span class="se">\</span>
</span><span class='line'>    sed <span class="s1">&#39;/^$/N;/\nmsgstr &quot;&quot;$/,/^msgid/!d&#39;</span> <span class="p">|</span> tac
</span><span class='line'>
</span><span class='line'><span class="o">[</span> <span class="k">$(</span>grep -c <span class="s1">&#39;, fuzzy&#39;</span> locale/da/LC_MESSAGES/django.po<span class="k">)</span> -gt <span class="m">1</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;=== Fuzzy translation:&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    grep <span class="s1">&#39;, fuzzy&#39;</span> locale/da/LC_MESSAGES/django.po -A2 <span class="p">|</span> tail -n +5 <span class="o">&amp;&amp;</span> <span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is no explicit call to <code>./manage.py check</code> because it is called
implicitly by the other management commands. An ideal run of the script
produces no output, but if you made a lot of errors, it could look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./ok.sh 
</span><span class='line'>======================================================================
</span><span class='line'>FAIL: test_basic_addition (docs.tests.SimpleTest)
</span><span class='line'>----------------------------------------------------------------------
</span><span class='line'>Traceback (most recent call last):
</span><span class='line'>  File "/home/erw/hstareal/docs/tests.py", line 16, in test_basic_addition
</span><span class='line'>    self.assertEqual(1 + 1, 3)
</span><span class='line'>AssertionError: 2 != 3
</span><span class='line'>
</span><span class='line'>Migrations for 'requisitions':
</span><span class='line'>  0002_auto_20150605_1757.py:
</span><span class='line'>    - Alter field supplier_postcode on requisition
</span><span class='line'>
</span><span class='line'>./requisitions/models.py:123:80: E501 line too long (108 &gt; 79 characters)
</span><span class='line'>./requisitions/admin.py:194:25: F821 undefined name 'messages'
</span><span class='line'>./requisitions/admin.py:441:25: F821 undefined name 'messages'
</span><span class='line'>
</span><span class='line'>=== Translation not up to date:
</span><span class='line'>1541c1541,1543
</span><span class='line'>&lt; msgid "postcode"
</span><span class='line'>---
</span><span class='line'>&gt; #, fuzzy
</span><span class='line'>&gt; #| msgid "postcode"
</span><span class='line'>&gt; msgid "postal code"
</span><span class='line'>
</span><span class='line'>=== Fuzzy translation:
</span><span class='line'>#, fuzzy
</span><span class='line'>msgid "internal account type"
</span><span class='line'>msgstr "interne kontotyper"
</span></code></pre></td></tr></table></div></figure>


<p>Now, all that is required is to run this one script before committing. A CI
server could of course be nice, but for a small project, this might be fine,
and cheaper.</p>

<p>One thing that is missing is to make the check in lines 18&ndash;19 of the script
aware of untranslated strings that you don&rsquo;t need to translate in your own
project, because they are covered in Django&rsquo;s own translation. For example, my
404 page says &ldquo;Page not found&rdquo; which Django already knows how to translate into
70+ languages. The script could also be generalized to process all locales &mdash;
right now it is hardcoded for Danish.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Sound of E]]></title>
    <link href="http://blog.erw.dk/2015/04/06/the-sound-of-e/"/>
    <updated>2015-04-06T12:16:44+02:00</updated>
    <id>http://blog.erw.dk/2015/04/06/the-sound-of-e</id>
    <content type="html"><![CDATA[<p>E is the most common letter in many European languages. In English it makes up
12&ndash;13% of all letters written depending on source (see for example
<a href="http://en.wikipedia.org/wiki/Letter_frequency">Wikipedia</a> or
<a href="http://practicalcryptography.com/cryptanalysis/letter-frequencies-various-languages/">Practical Cryptography</a>). The second place is T with
around 9%. In Dutch, Danish, and German, &lsquo;E&rsquo; goes as high as 15&ndash;17%. But
should it really be this common?</p>

<!-- more -->


<p>That is a perhaps a difficult question to answer. Another question is: Is
E always E? And here, the answer is a clear no, at least if we think of writing
primarily as a representation of the spoken language. I will look at the sound
of E in the two languages I know the best: Danish and English.</p>

<a name="English"></a>
<h2>English</h2>

<p>In English, the two most well-known versions are the short and long Es:</p>

<ul>
<li>h<strong>e</strong>llo, <strong>e</strong>legant &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_front_unrounded_vowel">ɛ</a> &mdash; Short e</li>
<li><strong>e</strong>vil, h<strong>e</strong>, sc<strong>e</strong>ne &mdash; <a href="http://en.wikipedia.org/wiki/Close_front_unrounded_vowel">i:</a> &mdash; Long e</li>
</ul>


<p>These are however not the most <em>common</em> realizations of E. Those are instead
the following two, even though you probably don&rsquo;t give them much thought:</p>

<ul>
<li>en<strong>e</strong>my, elev<strong>e</strong>n &mdash; <a href="http://en.wikipedia.org/wiki/Mid_central_vowel">ə</a> &mdash; <a href="http://en.wikipedia.org/wiki/Schwa">Schwa</a>, a short, &ldquo;lazy&rdquo;
vowel made while relaxing the mouth. In many accents, the first e of
<strong>e</strong>leven is also a schwa.</li>
<li>slat<strong>e</strong>, grip<strong>e</strong>, don<strong>e</strong> &mdash; Silent!</li>
</ul>


<p>The schwa is the most common vowel sound in English, and every vowel can be
pronounced that way if unstressed (<strong>a</strong>bout, penc<strong>i</strong>l, el<strong>o</strong>quent,
s<strong>u</strong>pply, vin<strong>y</strong>l).
The silent E is also called <a href="http://en.wikipedia.org/wiki/Silent_e">magic E</a> if its presence in spelling
modifies the pronunciation of other vowels. Compare for example <em>slat</em> and
<em>slate</em>, <em>grip</em> and <em>gripe</em>. On the other hand, the e in <em>done</em> is truly
silent; <em>don</em> and <em>done</em> are pronounced the same.
But here are still more ways to pronounce E:</p>

<ul>
<li>d<strong>e</strong>ter, d<strong>e</strong>test &mdash; <a href="http://en.wikipedia.org/wiki/Near-close_near-front_unrounded_vowel">ɪ</a> &mdash; Same as th<strong>i</strong>ng</li>
<li><strong>e</strong>nvelope &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_front_unrounded_vowel">ɛ</a>, <a href="http://en.wikipedia.org/wiki/Open_back_rounded_vowel">ɒ</a>, or <a href="http://en.wikipedia.org/wiki/Open_back_unrounded_vowel">ɑ</a> &mdash; (&ldquo;en-&rdquo;, &ldquo;on-&rdquo;, &ldquo;arn-&rdquo;)</li>
</ul>


<p>&ldquo;Envelope&rdquo; comes from French, but none of the three English pronunciations of
its E match the French nasal <em>en</em> <a href="http://en.wikipedia.org/wiki/Nasal_vowel">ɑ̃</a>. They do however appear in other
English words such as <strong>e</strong>nd and the UK and US versions of
<a href="http://en.wiktionary.org/wiki/swan#Pronunciation">sw<strong>a</strong>n</a>, respectively. From French we also have</p>

<ul>
<li>resum<strong>e</strong>, fianc<strong>e</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Close-mid_front_unrounded_vowel">e</a><a href="http://en.wikipedia.org/wiki/Near-close_near-front_unrounded_vowel">ɪ</a> &mdash; Also written é</li>
</ul>


<p>This is a <a href="http://en.wikipedia.org/wiki/Diphthong">diphthong</a>, or glide between two vowels, rather than
a pure vowel. It is again different from French, where é is simply pronounced
<a href="http://en.wikipedia.org/wiki/Close-mid_front_unrounded_vowel">e</a>. But the eɪ diphthong also appears in for example the English
pronunciation of Santa Fe from Spanish, and original English words such as
l<strong>a</strong>ne. (Though I always see this diphthong transcribed /eɪ/, I think many
dialects pronounce it [ɛɪ], i.e., with the sound <a href="http://en.wikipedia.org/wiki/Open-mid_front_unrounded_vowel">ɛ</a> from b<strong>e</strong>d, and
f<strong>a</strong>ce (which is, ironically, transcribed /feɪs/ on <a href="http://en.wiktionary.org/wiki/face#Pronunciation">Wiktionary</a>).)</p>

<p>There are also letter sequences that have special sounds:</p>

<ul>
<li>read<strong>er</strong>, play<strong>er</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Mid_central_vowel">ə</a> (typical UK) or <a href="http://en.wikipedia.org/wiki/R-colored_vowel">ɝ</a> (typical US)</li>
<li>t<strong>er</strong>m, G<strong>er</strong>man &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_central_unrounded_vowel">ɜ</a> (typical UK) or <a href="http://en.wikipedia.org/wiki/R-colored_vowel">ɝ</a> (typical US)</li>
<li>Fr<strong>eu</strong>dian &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_back_rounded_vowel">ɔ</a><a href="http://en.wikipedia.org/wiki/Near-close_near-front_unrounded_vowel">ɪ</a></li>
<li>f<strong>eu</strong>d, c<strong>ue</strong>, n<strong>ew</strong>, <strong>eu</strong>phemism &mdash; <a href="http://en.wikipedia.org/wiki/Palatal_approximant">j</a><a href="http://en.wikipedia.org/wiki/Close_back_rounded_vowel">u:</a> &mdash; Here,
E only represents a <a href="http://en.wikipedia.org/wiki/Semivowel">semivowel</a>, or glide.</li>
</ul>


<p>I <a href="http://blog.erw.dk/2015/02/21/the-sound-of-r/">wrote about R</a> previously, and how it can influence vowels, which is
what happens in the two first cases above. I always see suffix <em>-er</em>
transcribed as schwa (<a href="http://en.wikipedia.org/wiki/Mid_central_vowel">ə</a>) for <a href="https://en.wikipedia.org/wiki/Rhotic_and_non-rhotic_accents">non-rhotic</a> accents (typical
of the UK), but I suspect some accents pronounce it with a slightly more
A-like&nbsp;<a href="http://en.wikipedia.org/wiki/Near-open_central_vowel">ɐ</a>, from where we get slang spellings such as <em>playa</em> and
<em>gangsta</em>.</p>

<p>So far we have eight pure vowel sounds (<a href="http://en.wikipedia.org/wiki/Open-mid_front_unrounded_vowel">ɛ</a>, <a href="http://en.wikipedia.org/wiki/Close_front_unrounded_vowel">i</a>, <a href="http://en.wikipedia.org/wiki/Near-close_near-front_unrounded_vowel">ɪ</a>,
<a href="http://en.wikipedia.org/wiki/Open_back_rounded_vowel">ɒ</a>, <a href="http://en.wikipedia.org/wiki/Open_back_unrounded_vowel">ɑ</a>, <a href="http://en.wikipedia.org/wiki/Mid_central_vowel">ə</a>, <a href="http://en.wikipedia.org/wiki/Open-mid_central_unrounded_vowel">ɜ</a>, <a href="http://en.wikipedia.org/wiki/R-colored_vowel">ɝ</a>) and three diphthongs
(<a href="http://en.wikipedia.org/wiki/Close-mid_front_unrounded_vowel">e</a><a href="http://en.wikipedia.org/wiki/Near-close_near-front_unrounded_vowel">ɪ</a>, <a href="http://en.wikipedia.org/wiki/Open-mid_back_rounded_vowel">ɔ</a><a href="http://en.wikipedia.org/wiki/Near-close_near-front_unrounded_vowel">ɪ</a>, <a href="http://en.wikipedia.org/wiki/Palatal_approximant">j</a><a href="http://en.wikipedia.org/wiki/Close_back_rounded_vowel">u</a>). I have not included E&rsquo;s
function in the words <em>awe</em> and <em>eau</em> (as in <em>eau de toilette</em>), and
<em>rheumatism</em>, because it could be argued that it is silent. Especially, <em>au</em>
(as in <em>coq au vin</em>), is also pronounced [<a href="http://en.wikipedia.org/wiki/Close-mid_back_rounded_vowel">o</a>] (at least in French).
The Danish inventory is similarly large:</p>

<a name="Danish"></a>
<h2>Danish</h2>

<ul>
<li>d<strong>e</strong>n &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_front_unrounded_vowel">ɛ</a> &mdash; h<strong>e</strong>llo</li>
<li>d<strong>e</strong>t &mdash; <a href="http://en.wikipedia.org/wiki/Close-mid_front_unrounded_vowel">e</a> &mdash; Close to r<strong>e</strong>port</li>
<li>d<strong>e</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Close_front_unrounded_vowel">i</a> &mdash; Like h<strong>e</strong>, but short: happ<strong>y</strong></li>
<li>s<strong>e</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Close-mid_front_unrounded_vowel">e</a><a href="http://en.wikipedia.org/wiki/St%C3%B8d">ˀ</a> &mdash; With <a href="http://en.wikipedia.org/wiki/St%C3%B8d"><em>stød</em></a>; Like the e of
fianc<strong>e</strong> said very quickly</li>
<li>j<strong>e</strong>g &mdash; <a href="http://en.wikipedia.org/wiki/Open_back_unrounded_vowel">ɑ</a> &mdash; f<strong>a</strong>ther. Actually part of the diphthong [ɑj], but
can be pronounced alone here.</li>
<li>spis<strong>e</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Mid_central_vowel">ə</a> in emphatic speech &mdash; en<strong>e</strong>my</li>
<li>spis<strong>e</strong> &mdash; Silent in normal speech (<a href="http://en.wikipedia.org/wiki/Syllabic_consonant#Germanic_languages">assimilated schwa</a>)</li>
<li>spis<strong>er</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Near-open_central_vowel">ɐ</a> &mdash; e and r merge. Close to <a href="https://en.wikipedia.org/wiki/Rhotic_and_non-rhotic_accents">non-rhotic</a>
both<strong>er</strong>, but distinct from <a href="http://en.wikipedia.org/wiki/Schwa">schwa</a>.</li>
<li><strong>e</strong>r &mdash; <a href="http://en.wikipedia.org/wiki/Near-open_front_unrounded_vowel">æ</a> &mdash; Influence from R, but not merged with it. Tr<strong>a</strong>p.</li>
</ul>


<p>With the above words being first two genders of <em>it</em>/<em>that</em>/<em>the</em>, then <em>they</em>,
<em>see</em>, <em>I</em>, 2x <em>eat</em>, <em>eats</em>, and <em>is</em>, these realizations of E are all part of
the core of the language and not due to any loanword; not any recent ones at
least. If we add those, we get for example:</p>

<ul>
<li>r<strong>eu</strong>matisme &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_back_unrounded_vowel">ʌ</a><a href="http://en.wikipedia.org/wiki/Palatal_approximant">j</a> &mdash; Close to t<strong>oy</strong></li>
<li>voy<strong>eu</strong>r &mdash; <a href="http://en.wikipedia.org/wiki/Open-mid_front_rounded_vowel">œ</a> &mdash; (New Zealand b<strong>ir</strong>d)</li>
<li>mili<strong>eu</strong> &mdash; <a href="http://en.wikipedia.org/wiki/Close-mid_front_rounded_vowel">ø</a> &mdash; (South African b<strong>ir</strong>d)</li>
</ul>


<p>The last one is cheating a bit because it is no longer an accepted spelling in
Danish, where we instead use the logical &ldquo;miljø&rdquo;. But this decision is rather
arbitrary. For example, 30 years ago, the Danish language board tried to
change, among other things, the spelling of <em>mayonnaise</em> to the more logical
<em>majonæse</em>. And <a href="http://sproget.dk/raad-og-regler/artikler-mv/sproget-jyllands-postens-sprogklumme/majonesekrigen-25-ar-efter">people hated it</a> (link in Danish), even though
French words like <em>liqueur</em>, <em>portrait</em>, and <em>capitaine</em> were already spelled
<em>likør</em>, <em>portræt</em>, and <em>kaptajn</em> at the time!</p>

<a name="The.Sound.of.E"></a>
<h2>The Sound of E</h2>

<p>I have found the sounds above by looking at and pronouncing many words, and
also by looking through lists of vowel sounds, and looking for English and
Danish words with those sounds. Though somewhat systematic, I may have missed
some sounds of E. But what is interesting is that my list alone spans most of
our vowel capabilities! It goes from <a href="http://en.wikipedia.org/wiki/Close_vowel">high</a> and
<a href="http://en.wikipedia.org/wiki/Front_vowel">front</a> to <a href="http://en.wikipedia.org/wiki/Open_vowel">low</a> and <a href="http://en.wikipedia.org/wiki/Back_vowel">back</a>. An
example of the first is f<strong>ee</strong>t/d<strong>e</strong> [i], with the tongue high in the mouth
and the sound made near the front. The other end is f<strong>a</strong>ther/j<strong>e</strong>g [ɑ] with
the tongue low in the mouth and the sound made at the back.</p>

<p><span class='caption-wrapper right'><img class='caption' src='http://blog.erw.dk/images/posts/IPA_vowel_chart_2005_erw.png' width='' height='' alt='This work, English/Danish Es, [CC&nbsp;BY-SA&nbsp;4.0] [cc-by-sa4] by Erik R. Wognsen, is derived from [IPA vowel chart 2005] [wf_vowel_chart], [CC&nbsp;BY-SA&nbsp;3.0] [cc-by-sa3]'><span class='caption-text'>This work, English/Danish Es, <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC&nbsp;BY-SA&nbsp;4.0</a> by Erik R. Wognsen, is derived from <a href="http://en.wikipedia.org/wiki/File:IPA_vowel_chart_2005.png">IPA vowel chart 2005</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC&nbsp;BY-SA&nbsp;3.0</a></span></span></p>

<p>I have illustrated this above. Purple vowels are common to English and Danish,
blue vowels are English, and red are Danish. The blob sizes represent my rough
guess to how often these sounds are represented by the letter E, graduated in
three levels. For the common vowel sounds, e and ɑ are used more often in
Danish than in English, while i is used more in English. ɛ is used often in
both, and ə even more. For diphthongs, only the first component is shown to
keep it simple.</p>

<a name="Does.it.have.to.be.like.this."></a>
<h2>Does it have to be like this?</h2>

<p>As we can see from the picture, the letter E is perhaps so full of meaning that
it is almost meaningless. So we could ask ourselves whether it has to be like
this? Or, could have a more <a href="http://en.wikipedia.org/wiki/Phonemic_orthography">regular spelling</a>, so kids
could learn to read in <a href="http://www.theatlantic.com/education/archive/2015/02/how-the-english-language-is-holding-kids-back/385291/">months rather than years</a>?
This will be a future topic!</p>

<a name="E.on.the.Keyboard"></a>
<h2>E on the Keyboard</h2>

<p>In the meantime, E is still the most common letter in many languages. So how
easy should it be to type on a computer keyboard? Very easy, preferably.</p>

<p>The ergonomic, three-dimensional <a href="http://upload.wikimedia.org/wikipedia/commons/4/45/Maltron_Dual_Hand_keyboard_with_Malt_Key_distribution.jpg">Maltron keyboard</a> goes as far as to
put the letter E on the strongest finger: the thumb! Most other &ldquo;normal&rdquo;
layouts that improve on QWERTY put E on the home row, where you rest your hands
when <a href="http://en.wikipedia.org/wiki/Touch_typing">touch typing</a>. A good example is the Colemak keyboard
layout which I <a href="http://blog.erw.dk/2015/02/27/4-years-with-colemak/">wrote about recently</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Learning Lithuanian]]></title>
    <link href="http://blog.erw.dk/2015/03/27/learning-lithuanian/"/>
    <updated>2015-03-27T11:21:54+01:00</updated>
    <id>http://blog.erw.dk/2015/03/27/learning-lithuanian</id>
    <content type="html"><![CDATA[<p>Lithuanian is a very old language with connections to Latin, Ancient Greek and
Sanskrit. This quote is <a href="http://termcoord.eu/2014/08/ever-wanted-travel-back-time-talk-lithuanian-3/">attributed</a> to French linguist Antoine
Meillet:</p>

<blockquote><p>Anyone wishing to hear how Indo-Europeans spoke should come and listen to
a Lithuanian peasant.</p></blockquote>

<p><span class='caption-wrapper right'><img class='caption' src='http://blog.erw.dk/images/posts/lt-flag.jpg' width='512' height='365' alt='[Lithuanian Embassy Flag] [flickr_flag] by [Mr.TinDC] [flickr_mr] is licensed under [CC BY 2.0](https://creativecommons.org/licenses/by/2.0/)'><span class='caption-text'><a href="https://www.flickr.com/photos/mr_t_in_dc/3415891618/">Lithuanian Embassy Flag</a> by <a href="https://www.flickr.com/photos/mr_t_in_dc/">Mr.TinDC</a> is licensed under <a href="https://creativecommons.org/licenses/by/2.0/">CC BY 2.0</a></span></span></p>

<p>This is in itself very interesting, also because Lithuanian is less well-known,
and has survived bans and attempts of being eradicated in the past. I also have
a personal connection to the language because it is the native language of
<a href="http://www.bachata-geek.me/about-me/">my girlfriend</a> and her family. I am trying to learn it, and while I (slowly)
do so, two things stand out to me:</p>

<p>The first is that in Lithuanian, when you read a word, you know (almost) how to
pronounce it. This is very different from for example English and Danish, where
the connection between writing and pronunciation is complicated and fraught
with exceptions. See for example <a href="http://en.wikipedia.org/wiki/Ghoti">ghoti</a>, pronounced &ldquo;fish&rdquo;.</p>

<p>The second is that Lithuanian uses seven <em>cases</em>, which means a word has seven
different forms depending on its role in a sentence. A remnant of a case system
is seen in personal pronouns in English: <em>I helped her, and she helped me.</em> &ldquo;I&rdquo;
and &ldquo;me&rdquo;, as well as &ldquo;she&rdquo; and &ldquo;her&rdquo;, have the same &ldquo;meaning&rdquo;, but a different
form depending on roles such as subject and object. In Lithuanian, every noun
and adjective changes depending on role. And these roles include cool things
like being a location or an instrument or means of doing something!</p>

<!-- more -->


<a name="Writing"></a>
<h2>Writing</h2>

<p>Lithuanian is based on the Latin alphabet, but adds and removes some letters.
My favorites are the three extra consonants &mdash; Č, Š, and Ž &mdash; and their
logic:</p>

<ul>
<li>S is as in most languages: Like the &rsquo;s&#8217; in <strong>s</strong>peak in English.</li>
<li>Š is like the &lsquo;sh&rsquo; in <strong>sh</strong>are, or Engli<strong>sh</strong>.</li>
<li>Z is like a voiced S: Like &lsquo;z&rsquo; in <strong>z</strong>oo.</li>
<li>Ž, similarly, is like a voiced Š: Like the &rsquo;s&#8217; in mea<strong>s</strong>ure, the &lsquo;si&rsquo; in
vi<strong>si</strong>on, or the &lsquo;g&rsquo; in gara<strong>g</strong>e.</li>
<li>C is pronounced like &lsquo;ts&rsquo;, as in roo<strong>ts</strong>.</li>
<li>Č follows the pattern of S/Š and Z/Ž: It&rsquo;s like the &lsquo;ch&rsquo; in <strong>ch</strong>erry.</li>
</ul>


<p>I think it is interesting to have separate letters for these sounds. They are
compact and more predictable than in English where for example &lsquo;ch&rsquo; can be
pronounced as in &ldquo;<strong>ch</strong>erry&rdquo; (the standard č-sound), &ldquo;stoma<strong>ch</strong>&rdquo; (k-sound),
&ldquo;ma<strong>ch</strong>ine&rdquo; (š-sound), or even &ldquo;ya<strong>ch</strong>t&rdquo; (no sound).</p>

<p>That is not to say that they are 100% predictable. Coca-Cola, for example, is
still written Coca-Cola (even though I do enjoy pronouncing it &ldquo;tsotsa-tsola&rdquo;
for fun). But some imported words do change spelling. Can you guess what &ldquo;pica&rdquo;
is? (I&rsquo;d love to have some.)</p>

<p>All in all, the spelling is fairly systematic, but regarding stress/accent,
it&rsquo;s no better than English or Danish. From my Lithuanian book:</p>

<blockquote><p>Rules concerning word stress are really quite complicated in Lithuanian,
unfortunately, so it is best if you try to imitate both pronunciation and
stress [when listening].</p></blockquote>

<p>This is opposed to a language such as Spanish, where accents mark exceptions.
Most unmarked words are stressed on the penultimate (next-to-last) syllable, so
for example if <em>corazón</em> was written without the accent, it should be
pronounced co<strong>ra</strong>zon rather than cora<strong>zon</strong>.</p>

<p>But perhaps technology is changing this. Whereas accents and other
<a href="http://en.wikipedia.org/wiki/Diacritic">diacritics</a> are easy to add in handwriting, it takes
more time on computers and mobile phones, enough that they are often skipped in
casual writing, reducing the logic of the written language, in Spanish as well
as in Lithuanian. But that is all part of the evolution of languages.</p>

<a name="In.Any.Case"></a>
<h2>In Any Case</h2>

<p>In English, words&#8217; roles in sentences (subject, object, etc.) are marked with
word order and prepositions (to, in, on, etc.). But there is another way of
marking them, namely cases. Lithuanian has seven:</p>

<ul>
<li>Nominative &ndash; as subject (unmarked in English)</li>
<li>Genitive &ndash; possessive (of, &rsquo;s)</li>
<li>Dative &ndash; as indirect object (for, to)</li>
<li>Accusative &ndash; as direct object (unmarked in English)</li>
<li>Instrumental &ndash; as instrument/tool/means/company (using, with)</li>
<li>Locative &ndash; location (in)</li>
<li>Vocative &ndash; addressing someone (unmarked in English)</li>
</ul>


<p>Each noun has these seven forms, for example
al<strong>us</strong> (beer),
al<strong>aus</strong> (of beer, beer&rsquo;s),
al<strong>ui</strong> (for beer),
al<strong>ų</strong> (beer as object),
al<strong>umi</strong> (with beer),
al<strong>uje</strong> (in beer),
al<strong>au</strong> (O, beer!).
And then it has another seven forms in plural.
Here follows some examples of case use that I like.</p>

<a name="Examples"></a>
<h3>Examples</h3>

<p>The first is about Vilnius, the capital of Lithuania, and the locative case:</p>

<ul>
<li>Vilniaus centre yra daug bažnyčių.</li>
<li>Vilnius-GEN center-LOC are many church-GEN-PLUR.</li>
<li>of-Vilnius in-center are many of-churches.</li>
<li>There are many churches in the center of Vilnius.</li>
</ul>


<p>When I first decoded this sentence I was stoked. It is such a different way of
representing information. Another example I saw in an electrician&rsquo;s advert:</p>

<ul>
<li>Šviesa jūsų projektams.</li>
<li>Light-NOM you-GEN project-DAT-PLUR.</li>
<li>Light of-you for-projects.</li>
<li>Light for your projects.</li>
</ul>


<p>Last Christmas I got a present with a label with a single word on it: <em>Erikui</em>.
It is the dative case of my name so it means &ldquo;for Erik&rdquo;. But this does requires
a name with a special ending to fit into the declension paradigms. My
Lithuanian name is Erikas. Some possible endings are -as, -is, -us (masculine),
and -a and -ė (feminine).</p>

<p>The vocative (addressing) case is especially relevant for names. For example,
my girlfriend&rsquo;s dad&rsquo;s name is Tomas. But to get someone&rsquo;s attention, you use
the vocative: Tomai. This was weird to me at first, but on the other hand, if
you hear your name spoken, you can tell whether people are talking <em>to</em> you or
<em>about</em> you, which is nifty. Here are some examples of the instrumental case:</p>

<ul>
<li>Aš žaidžiu kamuoliu &#8594; I-NOM play ball-INS &#8594; I play with-ball &#8594; I play with a ball</li>
<li>Važiuoju autobusu su tavimi &#8594; (I) go bus-INS with you-INS &#8594; I go by bus with you</li>
</ul>


<p>As you can see in the second example, prepositions are still used. In this case
an explicit &ldquo;with&rdquo; to say &ldquo;with you as a companion&rdquo; rather than &ldquo;with you as
a means&rdquo;. Languages with even more cases such as Finnish and Estonian express
relationships like &ldquo;to&rdquo; and &ldquo;from&rdquo; <a href="http://en.wikipedia.org/wiki/Locative_case#Estonian">as cases</a>, while they
are prepositions in Lithuanian. In Lithuanian, prepositions can also be
overloaded. For example <em>po</em> + instrumental means &ldquo;under&rdquo; while <em>po</em> + genitive
means &ldquo;after&rdquo;.</p>

<p>Finally, a cute example of the locative:</p>

<ul>
<li>Du viename.</li>
<li>Two-NOM one-LOC.</li>
<li>Two in-one.</li>
<li>Two in one.</li>
</ul>


<a name="Learning.to.Count"></a>
<h3>Learning to Count</h3>

<p>I am fascinated with this case system, but it also takes a considerable amount
of time to build a vocabulary. One thing that is especially hard is counting.
As you have just seen, numbers can be used in the locative. But typically, the
case of the number just matches what it counts. &ldquo;Vien<strong>as</strong> tašk<strong>as</strong>,
penk<strong>i</strong> tašk<strong>ai</strong>&rdquo; means &ldquo;one point, five points&rdquo; in the nominative case.
But as an object in the sentence, it is different:</p>

<ul>
<li>Turiu vien<strong>ą</strong> tašk<strong>ą</strong> &mdash; I have one point (accusative singular)</li>
<li>Turiu penk<strong>is</strong> tašk<strong>us</strong> &mdash; I have five points (accusative plural)</li>
</ul>


<p>And on top of that, the genitive overrides for some numbers, for example those
ending in zero, while those ending in one are singular, even if the number
itself is not:</p>

<ul>
<li>Turiu dešimt tašk<strong>ų</strong> &mdash; I have 10 points (genitive plural)</li>
<li>Turiu dvidešimt tašk<strong>ų</strong> &mdash; I have 20 points (genitive plural)</li>
<li>Turiu dvidešimtvien<strong>ą</strong> tašk<strong>ą</strong> &mdash; I have 21 points (accusative
<em>singular</em>)</li>
</ul>


<p>Then add to that that numbers also decline for gender, and you have not one
word meaning &ldquo;two&rdquo;, but 14 (7 cases * 2 genders). Then you can add the ordinal
(&ldquo;second&rdquo;), which in Lithuanian has 7 cases * 2 genders * 2 numbers
(singular/plural) * 2 forms (pronominal/non-pronominal) + a neuter form =
<a href="http://en.wiktionary.org/wiki/antras#Declension">57 forms</a>.</p>

<p>On top of the two main types of numbers &mdash; cardinal/quantitative (one, two,
etc.) and ordinal (first, second, etc.) &mdash; Lithuanian has two more. The first
is a &ldquo;super-plural&rdquo; for counting groups and <a href="http://en.wikipedia.org/wiki/Plurale_tantum">plurals-only</a>, which,
in English, are words like scissors, clothes and electronics. The second is
a collective type for the size of groups: Where English speakers can talk about
a pair, a dozen, a hundred, or a million of x, Lithuanians can equally easily
talk about groups of any size.</p>

<a name="The.Beauty"></a>
<h2>The Beauty</h2>

<p>I am told by my better half that the collective numbers are not common in
everyday use, and that probably holds for some of the other grammatical
features I come across as well. But while some people learn about the roots of
Indo-European languages from Latin or Ancient Greek, I do it from Lithuanian.
Plus I learn to speak my girlfriend&rsquo;s language at the same time. And Lithuanian
is great for creating affectionate words! This quote is
<a href="http://termcoord.eu/2014/08/ever-wanted-travel-back-time-talk-lithuanian-3/">attributed</a> to Benjamin W. Dwight:</p>

<blockquote><p>Of all European languages, the Lithuanian has the greatest number of
affectionate and diminutive terms, more than the Spanish or Italian, even
more than Russian, and they can be multiplied almost indefinitely by adding
them to verbs and adverbs as well as adjectives and nouns. If the value of
a nation in the total sum humanity were to be measured by the beauty of its
language, the Lithuanian ought to have the first place among the nations of
Europe.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Debugging Complex Numbers]]></title>
    <link href="http://blog.erw.dk/2015/03/20/debugging-complex-numbers/"/>
    <updated>2015-03-20T20:34:38+01:00</updated>
    <id>http://blog.erw.dk/2015/03/20/debugging-complex-numbers</id>
    <content type="html"><![CDATA[<p>For my research I needed to implement a <a href="http://en.wikipedia.org/wiki/Discrete_Fourier_transform">discrete Fourier transform</a> in
the C-like programming language of the <a href="http://www.uppaal.org/">UPPAAL</a> model checker. One
option would be to port an existing C library such as <a href="http://www.fftw.org">FFTW</a>, but for
a proof of concept, porting a large, powerful library would be much slower
and less instructive than implementing a simpler algorithm myself.
Programming rant coming up.</p>

<!-- more -->


<p>I went with the <a href="http://en.wikipedia.org/wiki/Cooley%E2%80%93Tukey_FFT_algorithm#The_radix-2_DIT_case">Cooley-Tukey radix-2 decimation-in-time fast Fourier transform</a>,
which, despite the name, is one of the simpler choices.
Pseudocode adapted from Wikipedia:</p>

<pre><code>X[0,...,N−1] ← ditfft2(x, N, s):             DFT of (x[0], x[s], x[2s], ..., x[(N-1)s]):
    if N = 1 then
        X[0] ← x[0]                                  trivial size-1 DFT base case
    else
        X[0,...,N/2−1] ← ditfft2(x, N/2, 2s)         DFT of (x[0], x[2s], x[4s], ...)
        X[N/2,...,N−1] ← ditfft2(x+s, N/2, 2s)       DFT of (x[s], x[s+2s], x[s+4s], ...)
        for k = 0 to N/2−1                           combine DFTs of two halves into full DFT:
            t ← X[k]
            X[k] ← t + exp(−2πi k/N) X[k+N/2]
            X[k+N/2] ← t − exp(−2πi k/N) X[k+N/2]
        endfor
    endif

Here, ditfft2(x,N,1), computes X=DFT(x) out-of-place by a radix-2 DIT FFT,
where N is an integer power of 2 and s=1 is the stride of the input
x array. x+s denotes the array starting with xs.
</code></pre>

<p>I decided to handle the problem in two stages: 1) Implement the algorithm in
a high-level language (Python) to make sure I get the algorithm itself right,
and 2) reduce the use of high-level features until it is trivial to port to
a C-like language.</p>

<p>List handling in Python is always a charm, but the main high-level feature
I wanted was the handling of <a href="http://en.wikipedia.org/wiki/Complex_number">complex numbers</a> (notice the <code>−2πi</code>s
above). My first high-level version worked nicely &mdash; at least as compared with
the <code>fft</code> function of <a href="https://en.wikipedia.org/wiki/R_%28programming_language%29">R</a> with a few sample inputs. Code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="kn">import</span> <span class="nn">math</span>
</span><span class='line'><span class="n">EVEN</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="n">ODD</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">fft1</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">a</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">=</span> <span class="n">fft1</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">EVEN</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">fft1</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">ODD</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
</span><span class='line'>        <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">2j</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">2j</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next step was to handle the complex numbers manually, so they can be
represented by two doubles. At first I tried to handle the general case of
raising a real to a complex, but that was harder than I thought it would be.
Luckily my colleague Louise could derive it for me:</p>

<pre><code> a + bi      a                   a
x        =  x  cos(b ln(x)) + i x  sin(b ln(x))
</code></pre>

<p>(and I wish adding MathJax (LaTeX) to Octopress was a one-minute job, but it isn&rsquo;t.)</p>

<p>However, if I had remembered that in my case <em>x</em> = <em>e</em> and <em>a</em> = 0, it would
have been simpler. It even has a name, <a href="http://en.wikipedia.org/wiki/Euler%27s_formula">Euler&rsquo;s formula</a>, and it is
mindboggling in all its simple beauty:</p>

<pre><code> bi
e    =  cos(b) + i sin(b)
</code></pre>

<p>At least we both learned something about complex numbers!</p>

<p>The next (buggy) version of my code was this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="k">def</span> <span class="nf">fft2</span><span class="p">(</span><span class="n">a_re</span><span class="p">,</span> <span class="n">a_im</span><span class="p">):</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_re</span><span class="p">)</span>
</span><span class='line'>    <span class="k">assert</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_im</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">a_re</span><span class="p">,</span> <span class="n">a_im</span><span class="p">)</span>
</span><span class='line'>    <span class="n">c_re</span><span class="p">,</span> <span class="n">c_im</span> <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">a_re</span><span class="p">[</span><span class="n">EVEN</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">a_im</span><span class="p">[</span><span class="n">EVEN</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
</span><span class='line'>    <span class="n">c_re2</span><span class="p">,</span> <span class="n">c_im2</span> <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">a_re</span><span class="p">[</span><span class="n">ODD</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">a_im</span><span class="p">[</span><span class="n">ODD</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
</span><span class='line'>    <span class="n">c_re</span> <span class="o">+=</span> <span class="n">c_re2</span>
</span><span class='line'>    <span class="n">c_im</span> <span class="o">+=</span> <span class="n">c_im2</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
</span><span class='line'>        <span class="n">t_re</span><span class="p">,</span> <span class="n">t_im</span> <span class="o">=</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_re</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_im</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_re</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_im</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="n">c_re</span><span class="p">,</span> <span class="n">c_im</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>It didn&rsquo;t give the same output as the first one, and I couldn&rsquo;t see why, so
I put both versions in one to debug them in lockstep:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="k">def</span> <span class="nf">fft3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_re</span><span class="p">,</span> <span class="n">a_im</span><span class="p">):</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'>    <span class="k">assert</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_re</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_im</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_re</span><span class="p">,</span> <span class="n">a_im</span><span class="p">)</span>
</span><span class='line'>    <span class="n">c</span><span class="p">,</span> <span class="n">c_re</span><span class="p">,</span> <span class="n">c_im</span> <span class="o">=</span> <span class="n">fft3</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">EVEN</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">a_re</span><span class="p">[</span><span class="n">EVEN</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">a_im</span><span class="p">[</span><span class="n">EVEN</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
</span><span class='line'>    <span class="n">c2</span><span class="p">,</span> <span class="n">c_re2</span><span class="p">,</span> <span class="n">c_im2</span> <span class="o">=</span> <span class="n">fft3</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">ODD</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">a_re</span><span class="p">[</span><span class="n">ODD</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">a_im</span><span class="p">[</span><span class="n">ODD</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">+=</span> <span class="n">c2</span>
</span><span class='line'>    <span class="k">del</span> <span class="n">c2</span>
</span><span class='line'>    <span class="n">c_re</span> <span class="o">+=</span> <span class="n">c_re2</span>
</span><span class='line'>    <span class="k">del</span> <span class="n">c_re2</span>
</span><span class='line'>    <span class="n">c_im</span> <span class="o">+=</span> <span class="n">c_im2</span>
</span><span class='line'>    <span class="k">del</span> <span class="n">c_im2</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
</span><span class='line'>        <span class="n">t</span><span class="p">,</span> <span class="n">t_re</span><span class="p">,</span> <span class="n">t_im</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">2j</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">2j</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_re</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_im</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_re</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>        <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_im</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_re</span><span class="p">,</span> <span class="n">c_im</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Testing still showed that the approaches disagreed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="n">x1</span><span class="p">,</span> <span class="n">x2_re</span><span class="p">,</span> <span class="n">x2_im</span> <span class="o">=</span> <span class="n">fft3</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">complex</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span><span class='line'><span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">complex</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span> <span class="k">for</span> <span class="n">re</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x2_re</span><span class="p">,</span> <span class="n">x2_im</span><span class="p">)]</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;!&#39;</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="mi">0j</span><span class="p">)</span> <span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="mi">0j</span><span class="p">)</span> <span class="mi">0j</span>
</span><span class='line'><span class="p">(</span><span class="mf">1.22464679915e-16</span><span class="o">-</span><span class="mi">2j</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.22464679915e-16</span><span class="o">+</span><span class="mi">0j</span><span class="p">)</span> <span class="o">-</span><span class="mi">2j</span> <span class="err">!!!!!!!!!!</span>
</span><span class='line'><span class="mi">0j</span> <span class="mi">0j</span> <span class="mi">0j</span>
</span><span class='line'><span class="p">(</span><span class="o">-</span><span class="mf">1.22464679915e-16</span><span class="o">+</span><span class="mi">2j</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.22464679915e-16</span><span class="o">+</span><span class="mi">0j</span><span class="p">)</span> <span class="mi">2j</span> <span class="err">!!!!!!!!!!</span>
</span></code></pre></td></tr></table></div></figure>


<p>Stepping through the code in Winpdb, I found three things:</p>

<ul>
<li>Debugging is easier if you clean up temp variables in the namespace, hence
the <code>del</code> statements in <code>fft3</code>.</li>
<li>Debugging is easier if the complex numbers are represented as complex numbers
all the time, hence the test code giving <code>map(complex, a)</code> as the first
argument to <code>fft3</code> (rather than simply giving <code>a</code>).</li>
<li>Line 21 was the first to show the bug (for the given input): I had been so
focused on complex exponentiation that I had forgot all about
<a href="http://en.wikipedia.org/wiki/Complex_number#Multiplication_and_division">complex multiplication</a>! Which is btw

<ul>
<li>(a + bi) (c + di) = (ac - bd) + (bc + ad) i</li>
</ul>
</li>
</ul>


<p>Now I (naively hoped I) was done. Replacing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_re</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'><span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_im</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_re</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span class='line'><span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_im</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>by</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="n">p_re</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'><span class="n">p_im</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_re</span> <span class="o">+</span>  <span class="p">(</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span class='line'><span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_im</span> <span class="o">+</span>  <span class="p">(</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_re</span> <span class="o">-</span> <span class="p">((</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]))</span>
</span><span class='line'><span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_im</span> <span class="o">-</span> <span class="p">((</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>still didn&rsquo;t work. But that is just a silly bug: Reading <code>c_re[k + n / 2]</code> in
line 6 after it was overwritten in line 5. Python has a really nice solution
for problems like this: Do both <a href="https://docs.python.org/2/reference/simple_stmts.html#assignment-statements">assignments</a> at once!
Instead of lines 5 and 6:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="n">t_re</span> <span class="o">-</span> <span class="p">((</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])),</span>
</span><span class='line'>    <span class="n">t_im</span> <span class="o">-</span> <span class="p">((</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, the goal was using fewer high-level features, so my final solution
factors out the reused parts of the computation, which probably makes the code
simpler in this case anyway:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="n">p_re</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'><span class="n">p_im</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'><span class="n">mult_re</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span class='line'><span class="n">mult_im</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_im</span> <span class="o">*</span> <span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_re</span> <span class="o">*</span> <span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_re</span> <span class="o">+</span> <span class="n">mult_re</span>
</span><span class='line'><span class="n">c_im</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>         <span class="o">=</span> <span class="n">t_im</span> <span class="o">+</span> <span class="n">mult_im</span>
</span><span class='line'><span class="n">c_re</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_re</span> <span class="o">-</span> <span class="n">mult_re</span>
</span><span class='line'><span class="n">c_im</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_im</span> <span class="o">-</span> <span class="n">mult_im</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, after a few detours I got my &ldquo;manually&rdquo; computed complex numbers, and
learned a bit more about how complex numbers and FFTs work. Also, debugging
with a debugger (rather than print statements) doesn&rsquo;t mean you don&rsquo;t need to
modify your code &ndash; in my case, merging both functions made the debugging a lot
easier.</p>

<p>Finally, the Python <a href="https://docs.python.org/2/library/math.html"><code>math</code> library</a> doesn&rsquo;t support complex numbers!
But there is a good reason for that, as explained in the
<a href="https://docs.python.org/2/library/cmath.html"><code>cmath</code> (complex math) library</a>:</p>

<blockquote><p>The reason for having two modules is that some users aren’t interested in
complex numbers, and perhaps don’t even know what they are. They would rather
have <code>math.sqrt(-1)</code> raise an exception than return a complex number.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[4 Years with Colemak]]></title>
    <link href="http://blog.erw.dk/2015/02/27/4-years-with-colemak/"/>
    <updated>2015-02-27T13:38:30+01:00</updated>
    <id>http://blog.erw.dk/2015/02/27/4-years-with-colemak</id>
    <content type="html"><![CDATA[<p>As a young computer user I felt that something was wrong with the keyboard.
Like Morpheus says to Neo when they first meet:</p>

<blockquote><p>What you know you can&rsquo;t explain. But you feel it. You&rsquo;ve felt it your entire
life. That there&rsquo;s something wrong with the world. You don&rsquo;t know what it is
but it&rsquo;s there, like a splinter in your mind driving you mad. It is this
feeling that has brought you to me. Do you know what I&rsquo;m talking about?</p></blockquote>

<p>QWERTY.</p>

<p>Touch typing on the QWERTY keyboard layout is wrong. You can do it every day,
all day, but there&rsquo;s something wrong with it. Today, four years ago, I took the
red pill: I started using the <a href="http://colemak.com/">Colemak</a> keyboard layout.</p>

<p><span class='caption-wrapper'><img class='caption' src='http://blog.erw.dk/images/posts/colemak_qwerty_3d.png' width='' height='' alt='Comparison of QWERTY and Colemak keyboard layouts with letter frequencies. Graphics by Pavel Pavlov.'><span class='caption-text'>Comparison of QWERTY and Colemak keyboard layouts with letter frequencies. Graphics by Pavel Pavlov.</span></span></p>

<!-- more -->


<p>In the image above, the QWERTY and Colemak keyboard layouts are shown with the
height of each key set to the <a href="http://en.wikipedia.org/wiki/Letter_frequency#Relative_frequencies_of_letters_in_the_English_language">frequency</a> with which it is
used. With this view, a pattern becomes obvious: The most often used keys are
scattered in QWERTY and collected on the home row in Colemak (pronounced
Coal-Mac). This means that you have to move your fingers much less in Colemak.
In fact, the home row has only around ⅓ of keystrokes in QWERTY while in
Colemak it has ¾ in English. The backspace key that is also used fairly often
is also changed from an awkward pinky stretch to a prime location on the home
row: where the caps lock key used to be.</p>

<p><span class='caption-wrapper'><img class='caption' src='http://blog.erw.dk/images/posts/CmkNew_IBM-DIY_90d-erw.png' width='' height='' alt='Colemak Keyboard Figure (IBM style) by [Øystein Bech Gadmar] [DreymaR], [CC BY-NC 4.0] [cc-by-nc4], caps lock key retouched, colors adjusted.'><span class='caption-text'>Colemak Keyboard Figure (IBM style) by <a href="http://forum.colemak.com/profile.php?id=125">Øystein Bech Gadmar</a>, <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>, caps lock key retouched, colors adjusted.</span></span></p>

<p>Typing on Colemak is very smooth. Besides reducing the distance your fingers
have to travel, it also makes transitions from one letter to the next pleasant.
This is for example done by reducing repeated use of the same finger. QWERTY
repeats the same finger in some frequent <a href="http://en.wikipedia.org/wiki/Bigram">bigrams</a> (sequences of two
letters) such as <em>ed</em>, <em>de</em>, <em>ce</em>, <em>my</em>, and <em>un</em>. They might seem
inconspicuous, but they disrupt the flow of typing, and the latter two also
jump two rows. To type out
<em><a href="http://www.gutenberg.org/ebooks/1661">The Adventures of Sherlock Holmes</a></em> you would type 21782
same-finger bigrams on QWERTY and 5503 on Colemak. (On both layouts you would
in addition type 10095 same <em>letter</em> bigrams (<em>ll</em>, <em>ee</em>, etc.), but those are
not easily avoided.)</p>

<p>Longer sequences also flow smoothly. This is partly because they consist of the
shorter sequences mentioned above, which are themselves pleasant, and partly
because of <em>rolls</em>. These are sequences that just &ldquo;roll&rdquo; off your fingers. For
example, the common <a href="https://en.wikipedia.org/wiki/Trigram">trigrams</a> <em>ing</em>, <em>the</em>, <em>ent</em>, and <em>tio</em> flow
in one direction over the keyboard, left-to-right or right-to-left, making them
easy to type. Rolls on the same hand are even better: T<strong>hey</strong>, c<strong>oul</strong>d,
sh<strong>oul</strong>d, l<strong>ast</strong>, fi<strong>rst</strong>, med<strong>ium</strong>, cl<strong>ien</strong>t, ar<strong>oun</strong>d, sh<strong>arp</strong>,
<strong>arg</strong>ument. These (common) sequences almost makes typing fun!</p>

<p>But in the end, Colemak is a good balance of many desirable properties: Minimal
finger movement, smooth transitions, less work for the weaker fingers, a good
balance between hand alternation and rolls, and a good balance between right
and left hand.</p>

<p>As someone who works with computers all day, these past four years have been
much more comfortable due to Colemak. Therefore I would like to say thank you
to Shai Coleman for creating Colemak, and the Colemak <a href="http://forum.colemak.com/">community</a>
for encouragement and many discussions!</p>

<p>Below, some frequently asked questions, and my answers to them.</p>

<a name="Frequently.Asked.Questions"></a>
<h2>Frequently Asked Questions</h2>

<a name="Does.it.work.on.my.computer."></a>
<h3>Does it work on my computer?</h3>

<p>Yes. It&rsquo;s built into Mac OS X, Linux (X.org), *BSD, ChromeOS, Android, iOS
(for external keyboards), etc. Basically all the cool kids. You can also get
and customize it on Windows (even without admin privileges) with <a href="http://www.autohotkey.com/">AutoHotKey</a>
or <a href="http://pkl.sourceforge.net/">Portable Keyboard Layout</a>, OS X with <a href="http://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&amp;id=ukelele">Ukelele</a>, and Linux
with X.org xkb (built in). See <a href="http://colemak.com/Download">Colemak downloads</a>.</p>

<a name="Do.I.need.a.new..physical..keyboard."></a>
<h3>Do I need a new (physical) keyboard?</h3>

<p>No. Key labels are not good for touch typing on any layout. And only frequently
used keys change in Colemak compared to QWERTY, so the rare ones even keep
their correct labels if you need a peek for those.</p>

<a name="But.wait..why.touch.type.at.all."></a>
<h3>But wait, why touch type at all?</h3>

<p><a href="http://en.wikipedia.org/wiki/Touch_typing">Touch typing</a> means that you type without looking at the
keyboard or your hands. This means you can keep your focus on your work, which
avoids the overhead of switching your attention.</p>

<p>If you do not currently touch type, you can
kill two stones with one bird
by
learning touch typing on Colemak. It&rsquo;s also more fun because you start typing
real words instead of permutations of <em>fjdksl</em>!</p>

<a name="How.much.time.does.it.take.to.learn."></a>
<h3>How much time does it take to learn?</h3>

<p>Check out <a href="http://forum.colemak.com/viewforum.php?id=6">users&#8217; experiences</a> on the forum! For me
it took a couple of weeks to reach a workable level, and a couple of months to
become proficient.</p>

<p>Since then, a new and probably more comfortable method has paved the way for
learning Colemak: the <a href="http://forum.colemak.com/viewtopic.php?id=1858">Tarmak transitional layouts</a>.
Instead of switching all keys at once and being generally confused, you change
a few keys, adapt, change a few more, adapt again. This way, you can stay
fairly productive during the whole transition period. It&rsquo;s really quite clever.</p>

<a name="What.about.other.people.using.your.computer."></a>
<h3>What about other people using your computer?</h3>

<p>If you want to share the computer with others, all major OSes allow some quick
keyboard shortcut to switch layouts. If not, consider your alternative layout
a deterrent ;-)</p>

<a name="What.about.using.other.people.s.computers."></a>
<h3>What about using other people&rsquo;s computers?</h3>

<p>While primarily using an alternative layout, some people retain their ability
to type QWERTY, and others do not. <a href="http://www.ryanheise.com/colemak/">Here</a> are some tips on
retaining proficiency in both layouts.</p>

<p>Personally I lost interest in QWERTY after a few weeks of using Colemak. Now
I hunt and peck when I use other people&rsquo;s computers and enjoy the comfortable
99% of the time on my own computers.</p>

<a name="What.about.other.alternative.layouts."></a>
<h3>What about other alternative layouts?</h3>

<p>Colemak is neither the first nor the last attempt at a better keyboard layout.
It is however one of the better ones so far. You can see a comparison of
keyboard layouts at <a href="http://mkweb.bcgsc.ca/carpalx/?popular_alternatives">carpalx</a>.</p>

<a name="Does.it.work.for.my.language."></a>
<h3>Does it work for my language?</h3>

<p>Yes, probably. Colemak is made for English, but it supports <a href="http://colemak.com/Multilingual">many languages</a>
in the sense that you can type the necessary special characters and accents. It
is also likely that the letters that are most common in English (and therefore
easy to type on Colemak), are also frequent in your own language. It might not
be a perfect match, but it&rsquo;s probably a lot better than QWERTY and its cousins
(QWERTZ, AZERTY).</p>

<p>The special characters are inserted using the AltGr key. If you type 90%
English and 10% something else, AltGr will probably do fine. If your balance is
closer to 50/50, you could make a localized version of Colemak, or find an
existing one. There are no official Colemak versions available for languages
other than English (but there are some unofficial ones by the community).</p>

<p>The official approach is to use the standard Colemak including US style
punctuation symbol locations and use some punctuation keys for the most common
extra characters in your language (the less-than/greater-than key found between
Shift and Z on most non-US keyboards is a good first choice). For example, in
<a href="http://practicalcryptography.com/cryptanalysis/letter-frequencies-various-languages/french-letter-frequencies/">French</a>, &lsquo;é&rsquo; is frequent (2.4%) and a good
candidate for a dedicated key, while &lsquo;ê&rsquo; (0.1%) is not and can be typed using
the standard Colemak AltGr layer.</p>

<p>Another approach is to start with your native keyboard layout and drop in the
Colemak letter block. I will show that below because that is my own approach.
The reason to do this is the same reasoning that is behind Colemak proper:
Avoid moving low frequency keys (such as punctuation and rare letters). They
take longer to relearn because you practice them less often.</p>

<p>As a side note, if you don&rsquo;t type so much English but still want a better
layout, you could look for something made for your own language, for example
German (de-ergo, NEO, ADNW), French (Bépo, Dvorak-fr, bvofrak), Dutch (De
Correspondent), or Portuguese (pt-Nativo).</p>

<a name="Does.it.work.for.Danish."></a>
<h3>Does it work for Danish?</h3>

<p>Yes, see the section above. The main difference between Danish and English is
the addition of Æ, Ø, and Å. At 0.87%, 0.94%, and 1.19% respectively, they are
not extremely <a href="http://practicalcryptography.com/cryptanalysis/letter-frequencies-various-languages/danish-letter-frequencies/">frequent</a>. But on the other hand,
their sum is 3.0%, and having to reach for AltGr 2-3 times per sentence is more
than I want. (However, this can be made much easier by putting AltGr on the
Caps Lock location.)</p>

<p><span class='caption-wrapper right'><img class='caption' src='http://blog.erw.dk/images/posts/colemak_dk.png' width='' height='' alt='Danish Colemak. The shaded keys have moved compared to Danish QWERTY.'><span class='caption-text'>Danish Colemak. The shaded keys have moved compared to Danish QWERTY.</span></span></p>

<p>My solution keeps Ø and Å in their regular locations, while Æ only moves one
position up &mdash; like the semicolon key in English.</p>

<p>On top of that I have made some <a href="https://bitbucket.org/erw/colemak/src/default/dk">changes</a> to facilitate programming,
such as putting the brackets {[]} on AltGr-neio, putting backslash on the
½ key. These types of modifications are personal and you will probably want
something else. If you are a programmer, you can also use the &ldquo;standard&rdquo;
solution which is to use the US English layout (whether QWERTY or Colemak).</p>

<a name="What.about..Vim...vim_category.."></a>
<h3>What about <a href="http://blog.erw.dk/blog/categories/vim/">Vim</a>?</h3>

<p>The first difference you notice is that <em>j</em> and <em>k</em> have moved away from the
home row &mdash; and rightly so, because in typing, they are very rare: 0.22% and
0.81%. There are many options. Some people use vim as-is. Either because they
don&rsquo;t feel the need for any changes, or because they use the arrow keys anyway
(in which case I would recommend learning <em>hjkl</em>).</p>

<p><span class='caption-wrapper right'><img class='caption' src='http://blog.erw.dk/images/posts/colemak_vim_erw.png' width='' height='' alt='Vim remapping for Colemak'><span class='caption-text'>Vim remapping for Colemak</span></span></p>

<p>Some people make only minimal changes to Vim (see for example the end of
<a href="http://www.ryanheise.com/colemak/">this page</a>) while others use the opportunity to do a
<a href="http://forum.colemak.com/viewtopic.php?id=50">major refurnishing</a>.
My own approach is in between but conceptually simple. Keys are shifted around
two loops: <em>k</em>-<em>n</em>-<em>j</em>-<em>e</em> and <em>i</em>-<em>l</em>. This restores the normal <em>hjkl</em>
navigation cluster and puts next match <em>n</em> back on its previous location.
Insert <em>i</em> and end <em>e</em> are now on L and J. (You can memorize it as &lsquo;linsert&rsquo;
and &lsquo;jend&rsquo; until muscle memory takes over.) You can source <a href="https://bitbucket.org/erw/colemak/src/default/colemak.vim">my mappings</a>
from your .vimrc to try it out.</p>

<a name="What.about.using.an.Ergonomic.keyboard.instead."></a>
<h3>What about using an Ergonomic keyboard instead?</h3>

<p>That is a good idea.
Especially if it has a <a href="http://deskthority.net/wiki/Staggering#Matrix_layout">columnar or matrix</a> key layout.
Then it might even be better for comfort than switching layout.
The two approaches can also be combined.
That&rsquo;s what I do, but more on that later.</p>

<p>Thanks for reading!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Sound of R]]></title>
    <link href="http://blog.erw.dk/2015/02/21/the-sound-of-r/"/>
    <updated>2015-02-21T13:27:20+01:00</updated>
    <id>http://blog.erw.dk/2015/02/21/the-sound-of-r</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://upload.wikimedia.org/wikipedia/en/thumb/a/a0/Voiced_uvular_fricative_%28vector%29.svg/300px-Voiced_uvular_fricative_%28vector%29.svg.png" title="R" alt="R"></p>

<p>R is a common letter in many languages, but it represents vastly different
sounds. Sometimes even within the same language.
As <a href="https://en.wikipedia.org/wiki/Rhotic_consonant">Wikipedia says</a>:
<em>Being &ldquo;R-like&rdquo; is an elusive and ambiguous concept phonetically</em>.
In fact, we might not even consider the R-sound used in, say, Spain, related to
the R-sound used in France/Germany/Denmark, if they were not spelled the same.
However, it was the will of history that they are, and in this post, I will
present the three main families of R-sounds in European languages: English,
Spanish, and French.</p>

<p>I am trying to keep it jargon free; hence the names above. They are
a simplification, and in fact many languages use the three types. For example,
the &ldquo;Spanish&rdquo; type is also Italian, Finnish, Icelandic, Lithuanian, Polish,
Czech, etc. Some languages, such as <a href="http://youtu.be/iIWmTglqUzY">Dutch</a> and Portuguese also use
more than one type, even within a single dialect. In this post I will cover the
three &ldquo;mainstream&rdquo; R families plus a lot of other interesting R-facts,
including that R is sometimes a vowel!</p>

<p>(R is incidentally also a very nice <a href="https://en.wikipedia.org/wiki/R_%28programming_language%29">statistics program</a>, but that is
not the topic of this post!)</p>

<!-- more -->


<a name="English"></a>
<h2>English</h2>

<p>Since you are reading this in English, I think you are familiar with this type
of R:</p>

<p><audio controls>
<source src="https://upload.wikimedia.org/wikipedia/commons/1/1f/Alveolar_approximant.ogg" type='audio/ogg; codecs=vorbis' />
</audio>&nbsp;&nbsp;
<span style="vertical-align: top;">
<small>
<a href="https://en.wikipedia.org/wiki/File:Alveolar_approximant.ogg">Alveolar approximant</a> by <a href="https://commons.wikimedia.org/wiki/User:Peter_Isotalo">Peter Isotalo</a>,
<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC BY-SA 3.0</a>
</small>
</span></p>

<p>Consonants do not usually stand alone, so what you hear is the R mixed with
vowels: [ra ara].</p>

<p>There is some variation in where the English type R is used.
In <a href="https://en.wikipedia.org/wiki/Rhotic_and_non-rhotic_accents">non-rhotic</a> dialects, Rs that are not immediately followed by
a vowel disappear. A famous example is the sentence &ldquo;Park the car in Harvard
Yard&rdquo;. In a non-rhotic dialect, in Boston for example, it would be pronounced
&ldquo;Pahk the car in Hahvahd Yahd&rdquo;.
Dialects with <a href="https://en.wikipedia.org/wiki/Linking_and_intrusive_R#Intrusive_R">intrusive R</a> on the other hand
insert them where they didn&rsquo;t appear originally: &ldquo;I saw a film&rdquo; becomes &ldquo;I sawr
a film&rdquo; (<a href="https://www.youtube.com/watch?v=P-Q9D4dcYng#t=72">oh boy</a>).</p>

<a name="Spanish"></a>
<h2>Spanish</h2>

<p>The &ldquo;Spanish&rdquo; R covers two types, depending on whether you tap the tongue
<em>once</em> <a href="https://en.wikipedia.org/wiki/Alveolar_ridge">behind your upper front teeth</a> or roll it multiple
times:</p>

<p><audio controls>
<source src="https://upload.wikimedia.org/wikipedia/commons/a/a0/Alveolar_tap.ogg" type='audio/ogg; codecs=vorbis' />
</audio>&nbsp;&nbsp;
<span style="vertical-align: top;">
<small>
<a href="https://en.wikipedia.org/wiki/File:Alveolar_tap.ogg">Alveolar tap</a> by <a href="https://commons.wikimedia.org/wiki/User:Peter_Isotalo">Peter Isotalo</a>,
<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC BY-SA 3.0</a>
</small>
</span></p>

<p><audio controls>
<source src="https://upload.wikimedia.org/wikipedia/commons/c/ce/Alveolar_trill.ogg" type='audio/ogg; codecs=vorbis' />
</audio>&nbsp;&nbsp;
<span style="vertical-align: top;">
<small>
<a href="https://en.wikipedia.org/wiki/File:Alveolar_trill.ogg">Alveolar trill</a> by <a href="https://commons.wikimedia.org/wiki/User:Peter_Isotalo">Peter Isotalo</a>,
<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC BY-SA 3.0</a>
</small>
</span></p>

<p>Some languages use only one of these two. In (standard) Spanish, they are both
used: For single R (as in &ldquo;pero&rdquo;, meaning &ldquo;but&rdquo;) and double R (&ldquo;perro&rdquo;, &ldquo;dog&rdquo;),
respectively. (However, I once met a <em>Carmen</em> who told me she liked her name
pronounced with a roll consisting of three taps.)</p>

<p>This type of R is also where &ldquo;R-ness&rdquo; becomes strange: The single tap has
a D-like quality to it. For example, the <em>tt</em> in &ldquo;better&rdquo; in English is also
made by tapping the tongue on the gum ridge behind the front teeth!</p>

<p><audio controls>
<source src="https://upload.wikimedia.org/wikipedia/commons/4/45/En-us-better.ogg" type='audio/ogg; codecs=vorbis' />
</audio>&nbsp;&nbsp;
<span style="vertical-align: top;">
<small>
&ldquo;<a href="https://en.wikipedia.org/wiki/File:En-us-better.ogg">Better</a>&rdquo; by <a href="https://commons.wikimedia.org/wiki/User:Dvortygirl">Dvortygirl</a>,
<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC BY-SA 3.0</a>
</small>
</span></p>

<a name="French"></a>
<h2>French</h2>

<p>French R, German R, Danish R. Also known as
<a href="https://en.wikipedia.org/wiki/Guttural_R">guttural (throaty) R</a>.
Like the Spanish R, it can also be done with or without a trill:</p>

<p><audio controls>
<source src="https://upload.wikimedia.org/wikipedia/commons/a/af/Voiced_uvular_fricative.ogg" type='audio/ogg; codecs=vorbis' />
</audio>&nbsp;&nbsp;
<span style="vertical-align: top;">
<small>
<a href="https://en.wikipedia.org/wiki/File:Voiced_uvular_fricative.ogg">Voiced uvular fricative</a> by <a href="https://commons.wikimedia.org/wiki/User:Peter_Isotalo">Peter Isotalo</a>,
<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC BY-SA 3.0</a>
</small>
</span></p>

<p><audio controls>
<source src="https://upload.wikimedia.org/wikipedia/commons/c/cb/Uvular_trill.ogg" type='audio/ogg; codecs=vorbis' />
</audio>&nbsp;&nbsp;
<span style="vertical-align: top;">
<small>
<a href="https://en.wikipedia.org/wiki/File:Uvular_trill.ogg">Uvular trill</a> by <a href="https://commons.wikimedia.org/wiki/User:Peter_Isotalo">Peter Isotalo</a>,
<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC BY-SA 3.0</a>
</small>
</span></p>

<p>These sounds are produced while touching the back of the tongue to the <a href="https://en.wikipedia.org/wiki/Palatine_uvula">uvula</a>
&mdash; the dangly thing at the back of the throat. (Danes are in fact lazy and
only <em><a href="https://en.wikipedia.org/wiki/Approximant_consonant">approach</a></em> the back of the tongue to the uvula, but the
sound is almost the same.)</p>

<p>In the southern parts of Norway and Sweden, close to Denmark, this type of R is
also used.</p>

<a name="Portuguese"></a>
<h2>Portuguese</h2>

<p>I have not included Portuguese as a type of R, because this beautiful language
in fact uses a large array of sounds to pronounce the letter R, depending on
dialect and context. As <a href="https://en.wikipedia.org/wiki/Portuguese_language#Consonants">Wikipedia says</a>:</p>

<blockquote><p>The actual uvular pronunciation [χ ʁ ʀ] is common in Portugal, although the
older trill [r] is also heard. In Brazil, the total inventory of /ʁ/
allophones is rather long, or up to [r ç x ɣ χ ʁ ʀ ħ h ɦ]</p></blockquote>

<p>The pronunciation of an R at the beginning of a word in Brazil can be
especially counter-intuitive (at least if you&rsquo;re not from Brazil!). As
I learned from my Portuguese teacher (from <a href="https://en.wikipedia.org/wiki/Bras%C3%ADlia">Brasília</a>), the word
<em><a href="http://en.wiktionary.org/wiki/real#Portuguese">real</a></em> (meaning both real and royal, and being the Brazilian
currency), is pronounced <em><a href="http://www.forvo.com/word/real/#pt">heau</a></em>(!) An initial R is a breathy
H-sound, and a final L is a U-like sound.</p>

<a name="R.as.Vowel"></a>
<h2>R as Vowel</h2>

<p>In the section on the English R, I mentioned non-rhotic dialects (typical of
England) where Rs that are not immediately followed by a vowel disappear. But
it might be more correct to say that they are vowels. Sometimes they prolong
existing vowels, as in &ldquo;park the car&rdquo;, where the R prolongs the existing
A-sound: &ldquo;paak the caa&rdquo;. Other times, you can hear the R as a separate A-like
sound: beer [bia], your [yua/yoa], poor [pua/poa]. It also merges with E:
reader [reeda], bother [botha]. Technically, the sound is a
<em><a href="https://en.wikipedia.org/wiki/Schwa">schwa</a></em>, a &ldquo;lazy&rdquo;, neutral vowel made while relaxing the mouth.
I guess whoever invented the word &ldquo;gangsta&rdquo; also spoke a non-rhotic dialect.</p>

<p>I think this phenomenon is especially interesting because everybody knows that
R is a consonant, but in practice non-rhotic speakers pronounce something like
half of all Rs as a vowel!</p>

<p>The phenomenon is also part of Danish. For example, in &ldquo;stor&rdquo; [stoa], meaning
&ldquo;big&rdquo;, or &ldquo;biler&rdquo; [bila], meaning &ldquo;cars&rdquo;. The length of this vowel even
distinguishes meanings: svar [svaa], svare [svaaa], svarer [svaaaa], svarere
[svaaaaa]. These four words mean &ldquo;(an) answer&rdquo;, &ldquo;(to) answer&rdquo;, &ldquo;(an) answerer&rdquo;,
and &ldquo;(some) answerers&rdquo;. Even natives have trouble distinguishing these&hellip;</p>

<a name="Lojban"></a>
<h2>Lojban</h2>

<p>I will round off with the constructed language <a href="http://www.lojban.org/tiki/Lojban">Lojban</a> because it has
an interesting approach to the letter R.</p>

<p>You may have heard of the constructed language Esperanto. Unlike Lojban, the
older, and relatively successful Esperanto is Eurocentric (and uses the Spanish
type R). Lojban is made to make sense in <a href="http://en.wikipedia.org/wiki/Worldlang">the whole world</a>. Its
vocabulary is based on the most spoken languages worldwide: Mandarin, English,
Hindi, Spanish, Russian, and Arabic. Its inventory of sounds is also sparse,
which means that (small) variations in pronunciation of letters between
cultures do not disturb the meaning. Especially for R, any of the rhotic
(R-like) consonant sounds are allowed, so you can just choose the one that is
already in your native language, or the one that is the easiest to learn!</p>

<p>Its grammar is also fascinating. For example, it can use any
subject-verb-object order: SVO, SOV, OVS, OSV, VSO, VOS. It also has a complete
<a href="http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form">BNF</a>! (For those who know what that is.) But I will save that for some
other time!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Samba!]]></title>
    <link href="http://blog.erw.dk/2015/01/29/samba/"/>
    <updated>2015-01-29T10:42:32+01:00</updated>
    <id>http://blog.erw.dk/2015/01/29/samba</id>
    <content type="html"><![CDATA[<p>After spending the fall of 2014 doing research in the Netherlands, I have moved
home to Aalborg, Denmark and returned to the samba group <a href="https://www.facebook.com/SambaskolenPocoLoco">Poco Loco</a>.
The group has dancers and percussionists; I&rsquo;m one of the latter. Starting again
after my half-year break reminded me of how it was when I first started playing
samba. While you enjoy the video of the group here, I&rsquo;ll geek out on the
drumming below.</p>

<div class="video-container">
<iframe src="//www.youtube.com/embed/ogQt9G1zEN8?feature=player_detailpage" frameborder="0" allowfullscreen></iframe>
</div>




<!-- more -->


<p>In my gymnasium (high school) years, I played the drum kit, mostly rock music.
On the drum kit, you play with both hands and both feet simultaneously, so
coming from this background, I thought playing a single drum at a time should
be fairly easy. It turns out it&rsquo;s not!</p>

<p><span class='caption-wrapper right'><img class='caption' src='https://upload.wikimedia.org/wikipedia/commons/3/35/Tamborim.JPG' width='320' height='240' alt='[Tamborim](https://commons.wikimedia.org/wiki/File:Tamborim.JPG#mediaviewer/File:Tamborim.JPG) by [Alno](//commons.wikimedia.org/wiki/User:Alno) / [CC BY-SA 3.0](http://creativecommons.org/licenses/by-sa/3.0/)'><span class='caption-text'><a href="https://commons.wikimedia.org/wiki/File:Tamborim.JPG#mediaviewer/File:Tamborim.JPG">Tamborim</a> by <a href="//commons.wikimedia.org/wiki/User:Alno">Alno</a> / <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a></span></span></p>

<p>For example, there&rsquo;s the tiny <em>tamborim</em> which, despite its modest size (6&#8221;
&approx; 15 cm), contributes a lot to the character of the sound of a samba
<em>bateria</em>. Its basic pattern plays every 16th note, indefinitely, with one
hand. That requires good technique, first to be able to play at high speed at
all, then to keep going. (I hope I&rsquo;ll be able to do it some day!)</p>

<p>The <em>caixa</em> (<a href="https://en.wikipedia.org/wiki/Snare_drum">snare drum</a>) also plays every 16th note in the basic
pattern. Unlike with the tamborim, you can alternate the hands. But like the
tamborim, the rhythm is played with &ldquo;samba swing&rdquo; which gives an eager,
energetic feeling. It takes a lot of time readjust when your musical background
is rock-based. (You can hear the difference <a href="https://www.youtube.com/watch?v=FhiID-40EkY">in this video</a>, where
he switches between exaggerated, medium, and no swing.)</p>

<p>The <em>repinique</em> is a drum that can make different sounds depending on how it&rsquo;s
struck. Below is a video of a guy showing how it&rsquo;s played. The drum is used
by the leader to cue the breaks and perform calls that the rest of the bateria
answers. So it has a very important role. But playing it involves slapping your
hand into its metal rim 100-150 times per minute. And it sports tuning rods
that are always available for said hand to impale itself on. As one of my
bandmates said: You are not initiated until you have bled on your drum!</p>

<div class="video-container">
<iframe src="//www.youtube.com/embed/xwxyskWxoWU?feature=player_detailpage" frameborder="0" allowfullscreen></iframe>
</div>




<!--
I usually play the *surdo*

The rhythms must be played with "swing" to get the right, energetic feeling. 

surdos, chocalho
This is the reason I joined the group in the first place
-->


<p>Samba is hard, but it&rsquo;s great. Both when we practice and when we perform on the
street or on a stage. The driving, unending rhythm and the feeling of unity in
a group of people or a whole carnival are just awe-inspiring.</p>

<p>The atmosphere is also happy and relaxed. Mistakes are made, but you just play
on. It&rsquo;s more important to keep going than to play perfectly (there&rsquo;s an
important life lesson in that!)</p>

<p>I was also surprised when I returned from my half year break. I could no longer
consciously remember the many breaks and call/response sequences. But when the
leader played the calls, my hands automatically responded. It&rsquo;s like riding
a bike &ndash; you can do it, but you can&rsquo;t explain how.</p>

<p>Fun facts:</p>

<ul>
<li><p>Samba swing is in a way the opposite of jazz swing. Jazz swing/shuffle is
&ldquo;lazy&rdquo; and delays off-beat notes. Samba swing is &ldquo;eager&rdquo; and plays some of
the notes between the main beats too early.</p></li>
<li><p>You cannot keep time with your feet because you will be walking in a parade
at speeds that are likely independent of the music.</p></li>
<li><p>I still geek out and write down <a href="http://en.wikipedia.org/wiki/Drum_tablature">drum tabs</a> to learn and understand
new sequences, but after that the automated learning quickly takes over. Most
people in our group just learn by repetition, without writing it down.</p></li>
<li><p>Earlier in my life, the primary meaning of &ldquo;samba&rdquo; was a piece of
<a href="https://en.wikipedia.org/wiki/Samba_%28software%29">networking software</a>.</p></li>
<li><p>I have no idea why our group is called Poco Loco (a bit crazy) in Spanish,
when samba is Brazilian. I guess even the name is a bit crazy!</p></li>
</ul>


<p>If you live near Aalborg, and find this all interesting, we could sure use
a few more drummers (also dancers!). All you need is the interest (and at least
a hint of a sense of rhythm). See the <a href="https://www.facebook.com/SambaskolenPocoLoco">facebook page</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[User Experiences on a Train Trip]]></title>
    <link href="http://blog.erw.dk/2014/11/30/user-experiences-on-a-train-trip/"/>
    <updated>2014-11-30T09:36:40+01:00</updated>
    <id>http://blog.erw.dk/2014/11/30/user-experiences-on-a-train-trip</id>
    <content type="html"><![CDATA[<p>This week I travelled from Enschede in the Netherlands to Saarbrücken in
Germany for a research meeting. On the way I made some observations of
usability and user experience in the trains and on the train stations.
First we&rsquo;ll see some examples of bad design, then some good ones!</p>

<!-- more -->


<p><img class="right" src="http://blog.erw.dk/images/posts/hengelo_wachtruimte.jpg" title="TODO" alt="TODO"></p>

<p>First, a usability classic: Door handles. The waiting rooms at the Hengelo
train station had door handles with both horizontal and vertical bars on both
sides of the door. With this abundance of handles, I somehow assumed the door
would open both in and out. I was wrong, and there was no indication of which
way it really openend. Most people will probably just try something random and
be right about 50% of the time.</p>

<p>This might seem like complaining over an insignificant problem, but the point
is simply to demonstrate principles of building products that people like,
whether it&rsquo;s a door or an iPhone. One part of doing this is to make simple
operations (such as opening a door) self-explanatory by design, and not make
the user feel stupid &mdash; such as when you open a door the wrong way.</p>

<p>Next up was my ticket, which was a print-at-home e-ticket. My Dutch is not so
good, but the ticket had a nice illustrated instruction of how I was supposed
to scan the ticket at the station:</p>

<p><img class="center" src="http://blog.erw.dk/images/posts/ns_e-ticket.jpg" title="TODO" alt="TODO"></p>

<p>Only there was no scanner in sight on the station. I had plenty of time, so
I went to the ticket office to ask what to do. There I learned that this
station had no scanners, so I should just board the train without scanning. And
this is probably what many people would do. But I didn&rsquo;t want
a misunderstanding to cost me a fine on the train, so I asked. And I was not
the first one to worry about it because they had put a piece of paper on the
ticket stall window saying the same thing: At this station it is not necessary
to scan the e-tickets. I recommended them to put that sign on the platforms
where people actually look for the scanners and therefore need the information.</p>

<p>On the train they had a nice info screen. But here I got momentarily confused
as well. This was a bit of Dutch I could understand: &ldquo;Aankomsttijd eindpunt&rdquo;:
Arrival time at the final destination.</p>

<p><img class="center" src="http://blog.erw.dk/images/posts/syntus_train.jpg" title="TODO" alt="TODO"></p>

<p>The only problem was that this final arrival time, 7:17, was <em>now</em>. I had
entered a train that was already at its destination and not going further. And
thereby possibly missed the correct train. Panic! Well, I soon found my
misunderstanding: 7:17 was indeed the current time because it was a clock, and
the real final arrival time was 7:53.</p>

<p>Besides, why would there be more stops on the list if we were already at the
final station? But the point here is not that logical thinking can lead me to
the correct interpretation of the information (which is indeed what happened).
The point is that before I had read enough from the screen to draw the right
conclusion, I had already been startled.
The problem comes from our perception that things that are close together
belong together. After reading &ldquo;Aankomsttijd eindpunt&rdquo;, my eyes were simply
drawn to left because the clock was both closer and bigger than the correct
arrival time.</p>

<p><img class="right" src="http://blog.erw.dk/images/posts/ns_speaking_zone.jpg" title="TODO" alt="TODO"></p>

<p>Only 20 minutes passed and I already misunderstood three things. How stupid
I must be! Well, it&rsquo;s easy to blame yourself for these things, when in fact the
design is to blame. Think about that next time you feel stupid because of your
microwave oven.</p>

<p>After I switched trains, I found something nice. Instead of just marking the
silent zone of the train as such, the normal zone was also marked as a speaking
zone. It&rsquo;s nice to not only have negative signs with bans, but also positive
signs. Who knows, it might even inspire someone to talk to a stranger!</p>

<p>Next up was Arnhem train station. Newly renovated and a good example that
a pleasant environment can give you a better experience than a functionally
equivalent but ugly environment. Arnhem station was both spacious and elegant
(and functional):</p>

<p><img class="center" src="http://blog.erw.dk/images/posts/arnhem.jpg" title="TODO" alt="TODO"></p>

<p>Another aspect of train usability is door opening buttons.
On the return trip I found two types.
The left is from the inside of a Dutch train; the right is from the outside of
a German ICE train:</p>

<p><img class="center" src="http://blog.erw.dk/images/posts/train_door_buttons.jpg" title="TODO" alt="TODO"></p>

<p>Train doors cannot be opened by passengers while the train is in motion, so the
buttons are only active at stations. The left set of buttons leaves the user to
guess when they become enabled, while the right set lights up when active, thus
displaying their state to the user, including which button is relevant to press
(&lsquo;close&rsquo; when the door is open and vice versa).</p>

<p>Finally, tables. In <a href="http://blog.erw.dk/2014/11/21/the-design-of-everyday-things/">my previous post</a> I explain how the of table locks
in the Danish IC3 trains suck. The Dutch and German ones are better. Dutch on
the left, German ICE on the right:</p>

<p><img class="center" src="http://blog.erw.dk/images/posts/tray_tables.jpg" title="TODO" alt="TODO"></p>

<p>This time I&rsquo;ll give the first price to the Dutch train. The table has no lock;
friction holds the table in place. The edge can be grabbed by either hand, and
it is self-explanatory. It can also be folded back up with one hand. The ICE
train table is also easy to <em>understand</em> how to use, but physically sliding the
lock is slightly awkward. In addition it requires two hands to close; one
holding the table, and one operating the lock. (Alternatively, you can slam it
shut and make a loud noise!)</p>

<p>Thanks for reading.</p>

<p><em>The <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/StillImage" rel="dct:type">images on this post</span> are by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Erik Ramsgaard Wognsen</span> and you may reuse them under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. Contact me for higher resolutions.</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Language of vi, Improved]]></title>
    <link href="http://blog.erw.dk/2014/11/25/the-language-of-vi-improved/"/>
    <updated>2014-11-25T02:50:20+01:00</updated>
    <id>http://blog.erw.dk/2014/11/25/the-language-of-vi-improved</id>
    <content type="html"><![CDATA[<p>In <a href="http://blog.erw.dk/2014/10/31/the-essence-of-vi/">a previous post</a> I described the &ldquo;language&rdquo; metaphor of the text
editor <a href="http://en.wikipedia.org/wiki/Vi">vi</a>. To recap,</p>

<ul>
<li>Verbs are commands such as change <code>c</code>, delete <code>d</code>, yank <code>y</code>, and put <code>p</code></li>
<li>Nouns (text objects): a paragraph <code>ap</code>, a string <code>a"</code>, etc.</li>
<li>Prepositional phrases (motions):
&ldquo;to the next word&rdquo; <code>w</code>,
&ldquo;to the next regex&rdquo; <code>/</code></li>
<li>Numerals (counts) as seen in
&ldquo;indent ten lines&rdquo; <code>10&gt;&gt;</code> and
&ldquo;to the 27th line&rdquo; <code>27gg</code>.</li>
</ul>


<p>This time around, we&rsquo;ll see how <a href="http://www.vim.org/about.php">Vim</a> (vi improved) adds a new word order
to make you speak more clearly, and <em>meta-verbs</em> to blow your mind!</p>

<!-- more -->


<a name="Speak.Before.You.Think"></a>
<h2>Speak Before You Think</h2>

<p>Near the end of my previous post we got to the numerals, or counts as they&rsquo;re
officially called. Counts are useful, especially when large numbers are
involved, but sometimes it pays off to use Vim without thinking too much ahead.
Just start speaking:</p>

<blockquote><p>Delete &hellip; a bit more &hellip; a bit more &hellip; bit more &hellip; ok, stop.</p></blockquote>

<p>While this is the way many people delete text on their computer, Vim makes it
a lot more efficient than the typical awkward bursts of holding down the delete
key until you delete enough (and probably too much). For example, <code>dw....</code>
deletes one word, then the next, and so on, five in total. (Remember,<code>dw</code>
deletes one word, and the dot <code>.</code> command repeats this action.) This can be
faster than the equivalent <code>d5w</code> because you don&rsquo;t need to count the words
before you start deleting . The running feedback you get by seeing the words
disappear one by one is very helpful and avoids the mistakes that could have
happened due to miscounting. It is especially useful for objects that vary
considerably in size (sentences, paragraphs), because they are harder to count
quickly.</p>

<p>But this approach doesn&rsquo;t work for common operations such as change <code>c</code> or yank
<code>y</code>. When you yank (copy), you most likely want all the text in the clipboard
at the same time; not one word replacing the next until you are left with only
the last word in the clipboard. Probably for the same reason, the repeat <code>.</code>
command doesn&rsquo;t consider yanking a repeatable action. (By the way, I say &lsquo;the
clipboard&rsquo; because it is a familiar term to many, but in Vim, they&rsquo;re called
registers, and there&rsquo;s a whole lot more than one of them!) Instead of repeat,
we can use <em>visual mode</em>, which gives both pleasant feedback and works with all
actions.</p>

<a name="L....or.Speak.Like.Yoda"></a>
<h2>&hellip; or Speak Like Yoda</h2>

<p><span class='caption-wrapper right'><img class='caption' src='http://upload.wikimedia.org/wikipedia/commons/4/49/Teletype-Fernschreiber_T100_Siemens.jpg' width='382' height='346' alt='[Fernschreiber Modell T100] [fernschreiber_link] by [Nightflyer] [fernschreiber_author] / [CC BY-SA 3.0] [fernschreiber_cc]'><span class='caption-text'><a href="http://commons.wikimedia.org/wiki/File:Teletype-Fernschreiber_T100_Siemens.jpg#mediaviewer/File:Teletype-Fernschreiber_T100_Siemens.jpg">Fernschreiber Modell T100</a> by <a href="http://de.wikipedia.org/wiki/User:Nightflyer">Nightflyer</a> / <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a></span></span></p>

<p>To explain visual mode, we will first pay the 1970s
a brief visit.  In vi, &ldquo;visual mode&rdquo; was a mode that was &ldquo;more visual&rdquo; than the
<a href="http://en.wikipedia.org/wiki/Teleprinter">Teletype</a> oriented editors vi
superseded and subsumed
(<a href="http://en.wikipedia.org/wiki/Ed_%28text_editor%29">ed</a> and
<a href="http://en.wikipedia.org/wiki/Ex_%28text_editor%29">ex</a>, respectively).  It
meant simply that you could see the file <em>while you edited it</em>.  However, this
form of visual feedback was soon considered normal.  Case in point, vi&rsquo;s visual
mode is Vim&rsquo;s normal mode.</p>

<p>The way to be more visual than Vim&rsquo;s normal mode is to highlight the text that
will be changed before the change is executed. This is similar to selecting
text in mainstream editors with the mouse or by using the arrow keys with the
shift key held down. In these, typing while text is selected replaces the
selected text with the typed text. Vim&rsquo;s visual mode however retains the
keyboard&rsquo;s &ldquo;gamepad role&rdquo; (see <a href="http://blog.erw.dk/2014/10/31/the-essence-of-vi/">my previous post</a>). (Vim also has
a &ldquo;mainstream&rdquo; <em>select mode</em> but it is mainly used to imitate
<strike>lesser</strike> other editors.)</p>

<p>You enter visual mode using <code>v</code>, then use text objects and motions to highlight
the text you want to affect. This reverses the word order in the vi language,
effectively making you command Vim like Yoda:  &ldquo;These lines delete (you must!)&rdquo;
Compare:</p>

<ul>
<li><code>das</code>: &ldquo;Delete a sentence.&rdquo;</li>
<li><code>vasd</code>: &ldquo;A sentence delete.&rdquo;</li>
<li><code>dasdw</code>: &ldquo;Delete a sentence. Delete the next word.&rdquo;</li>
<li><code>vased</code>: &ldquo;A sentence and the next word delete.&rdquo;</li>
</ul>


<p>So, visual mode is nice because it gives visual feedback on the area you are
going to operate on before you commit to it and type the operator. But it
doesn&rsquo;t stop there.</p>

<a name="Visual.Basics"></a>
<h2>Visual Basics</h2>

<p>What would you do if you had a lot of gamepad real estate to go along with
visual mode?</p>

<p>First of all, visual mode actually comes in three flavors: Character <code>v</code>, line
<code>V</code>, and block <code>&lt;c-v&gt;</code>. Here I switch around between them a bit:</p>

<p><video controls>
<source src='http://blog.erw.dk/videos/posts/vimvisual.webm' type='video/webm; codecs=vp8' />
</video></p>

<p>(The numbers in the margin show the line number for the line the
cursor is on, and the distance to the other lines. This <a href="http://vimdoc.sourceforge.net/htmldoc/options.html#%27relativenumber%27">feature</a> makes is easy to use counts with line-based operators.)</p>

<p>Visual character mode is the one you will find most familiar: The selection
starts somewhere, continues along the direction of the text, wraps at the ends
of lines, and ends somewhere. In visual <em>line</em> mode, every whole line from the
one the selection starts in to the one it ends in, is selected. This makes it
easy to select whole lines without moving the cursor to the start and end of
a line. Especially useful in programming, where line is often synonymous with
<em>statement</em>. Finally, visual block mode selects a rectangle of text. Applying
operators to blocks is very powerful and enables things that would take a long
time without block mode.</p>

<p><video class='right' controls>
<source src='http://blog.erw.dk/videos/posts/vimblock.webm' type='video/webm; codecs=vp8' />
</video></p>

<p>Block mode can also be used to insert text at several lines simultaneously.
From block mode, insert <code>I</code> and append <code>A</code> start insert mode, and when the
insertion is done, that text is then inserted in every line along the left or
right edge of the block, respectively.
Also, the <code>$</code> motion can be used to extend the selection to the ends of
lines. If the lines have different lengths, the result is a jagged block.
Appending <code>A</code> to this inserts text at the end of each line, wherever the end of
that line is. In the video I demonstrate both <code>I</code> and <code>A</code>. Here&rsquo;s a breakdown:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;c-v&gt;</span>jj$Ifoo(<span class="nt">&lt;esc&gt;</span>gvA)<span class="nt">&lt;esc&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;c-v&gt;</span>                         Ctrl-v to start visual block mode
</span><span class='line'>     jj$                      Move cursor two down and to the end of line
</span><span class='line'>        I                     Start block insert mode
</span><span class='line'>         foo(                 Write &quot;foo(&quot;
</span><span class='line'>             <span class="nt">&lt;esc&gt;</span>            Escape to normal mode (completes the other lines)
</span><span class='line'>                  gv          Start visual mode with previous selection
</span><span class='line'>                    A         Start appending in block insert mode
</span><span class='line'>                     )<span class="nt">&lt;esc&gt;</span>   Write &quot;)&quot; and escape to normal mode
</span></code></pre></td></tr></table></div></figure>


<p>All this might look scary, but that&rsquo;s of course part of what makes it so cool!</p>

<p>In the end of the video I do the same thing in one step using Tim Pope&rsquo;s
<a href="https://github.com/tpope/vim-surround">surround.vim</a> plugin. With the same selection active, I use
<code>Sf</code> to &ldquo;surround with function-call&rdquo;, type &ldquo;foo&rdquo; and enter.</p>

<a name="Neat.Tricks"></a>
<h3>Neat Tricks</h3>

<p>Have you tried selecting text in a mainstream editor and finding out you
started the selection in the wrong place? So you do the selection again, and do
it right this time. Well, Vim is all about efficiency: In visual mode, <code>o</code>
moves the cursor to the other end of the selection, so you can adjust it
without starting over. As amazing as it is simple! A soft, smiling kitten is
born every time you use this feature.</p>

<p>Also, with visual mode, you can crawl up the DOM tree: <code>at</code> extends the
selection to the enclosing tag-block (Vim-speak for an HTML/XML element).
Applied repeatedly, a bigger and bigger block of markup is selected,
corresponding to nodes further up the DOM tree.</p>

<p>Both visual mode and repeat <code>.</code> can be used in the &ldquo;speak before you think&rdquo;
manner, but visual mode works with all operators. It also has another advantage
over repeat: The operation is &ldquo;committed&rdquo; in one step, so it can be <em>undone</em> in
one step. This brings us to &hellip;</p>

<a name="Meta-Verbs"></a>
<h2>Meta-Verbs</h2>

<p><em>Undo</em> is a verb. It&rsquo;s a verb for a command that reverts the latest change, no
surprises there. But what happens when you undo two times in a row?</p>

<p>In vi, undo is a change like any other. Thus, if the latest change is an undo,
undo will revert that undo action. In other words, typing <code>uu</code> is a no-op! Vim,
being &ldquo;vi improved&rdquo;, can <a href="http://vimdoc.sourceforge.net/htmldoc/undo.html#undo-two-ways">emulate vi</a> or use its own improved undo,
which could be called a <em>meta-verb</em>: Verbs change text, but meta-verbs change
changes. So undo <code>u</code> and redo <code>&lt;c-r&gt;</code> go back and forth in the change history,
as is common in most modern programs.  But there&rsquo;s more:</p>

<p>Let&rsquo;s say you are writing a blog post.  Well into the process you remember an
earlier phrasing that you changed, but now you want it back.  You take numerous
steps back in history (perhaps employing a count: <code>25u</code>) until you find it. You
copy it, and you&rsquo;re ready to continue.  But before you remember that you should
redo to return to the newest version of the document, you make a new change.
If you used a simpler editor that version would now be lost forever.</p>

<p>Vim knows that undo/redo is not a linear history, it is a tree. Normal,
sequential changes extend a single branch of the tree. But when you go back and
make a new change as in the example above, that change sprouts another
branch. Vim <a href="http://vimdoc.sourceforge.net/htmldoc/usr_32.html">stores this tree</a> and let&rsquo;s you recover your work.</p>

<p><video class='right' controls>
<source src='http://blog.erw.dk/videos/posts/vimundotree.webm' type='video/webm; codecs=vp8' />
</video></p>

<p>In this video, I demonstrate the undo tree with all changes being adding small
bits of text, and the layout of the text representing the branches of the tree.
Undo <code>u</code> and redo <code>&lt;c-r&gt;</code> always go up and down the current branch (in this
video literally up and down). The commands <code>g-</code> and <code>g+</code> go through older and
newer <em>changes</em> to the text, which can be spread around the tree. I go
backwards with <code>g-</code> (watch for the &lsquo;g&rsquo; in the lower right corner) through the
events of entering &ldquo;six&rdquo; and &ldquo;five&rdquo; to the state after entering &ldquo;four&rdquo;, which
is in the original branch, before undoing &ldquo;three&rdquo; and &ldquo;four&rdquo;. Using <code>g+</code> brings
me forward again to the changes in the new branch.</p>

<p>Because all changes are ordered chronologically (no matter the undos and redos
done between them and the sprouting of new branches), they can be accessed
in a linear history with <code>g-</code> and <code>g+</code>. You can even travel in time explicitly:
<code>:earlier 3m</code> (minutes), <code>:later 2h</code> (hours). But in practice all you might
need is a few <code>g-</code>es once in a blue moon.</p>

<p>On top of that we have <a href="http://vimdoc.sourceforge.net/htmldoc/undo.html#undo-persistence">persistent undo</a> between sessions, which
I think makes Vim&rsquo;s undo the most powerful undo functionality I have seen in
a program. If you know of any contenders, please leave a comment!</p>

<p>Vim itself never actually shows you the tree directly, but <a href="http://stevelosh.com/">Steve Losh</a>&rsquo;s
graphical undo a.k.a. <a href="http://sjl.bitbucket.org/gundo.vim/">Gundo</a> plugin looks nice for that purpose
(<a href="http://www.screenr.com/M9l">screencast here</a>).</p>

<p>Now you have seen two powerful features that are in Vim but not vi: visual mode
and the undo system. Here&rsquo;s one more before we end:</p>

<a name="Record.and.Replay.Changes"></a>
<h3>Record and Replay Changes</h3>

<p>Another meta-verb is <em>record</em> <code>q</code> &mdash; it doesn&rsquo;t change the text by itself, but
it records the use of other verbs. The recording can then be played back by
(regular verb) <em>execute</em> <code>@</code> to use the same changes in a new context.</p>

<p>The xkcd forums user EvanED once <a href="http://forums.xkcd.com/viewtopic.php?f=40&amp;t=15855#p577619">demonstrated</a> how he used emacs to
efficiently</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="c1">// turn this ...</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">stateDoOperation1</span><span class="p">(</span><span class="n">state</span><span class="o">*</span> <span class="n">state</span><span class="p">,</span> <span class="kt">int</span> <span class="n">param1</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">stateDoOperation2</span><span class="p">(</span><span class="n">state</span><span class="o">*</span> <span class="n">state</span><span class="p">,</span> <span class="kt">int</span> <span class="n">param1</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">stateDoOperation3</span><span class="p">(</span><span class="n">state</span><span class="o">*</span> <span class="n">state</span><span class="p">,</span> <span class="kt">int</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">param2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ... into this:</span>
</span><span class='line'><span class="n">doOperation1</span><span class="p">(</span><span class="kt">int</span> <span class="n">param1</span><span class="p">);</span>
</span><span class='line'><span class="n">doOperation2</span><span class="p">(</span><span class="kt">int</span> <span class="n">param1</span><span class="p">);</span>
</span><span class='line'><span class="n">doOperation3</span><span class="p">(</span><span class="kt">int</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">param2</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I <a href="http://en.wikipedia.org/wiki/Editor_war">defended the honor</a> of Vim with this salvo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>qqdfe~fsdf,x<span class="nt">&lt;enter&gt;</span>q2@q
</span><span class='line'>
</span><span class='line'>qq                        start recording to register &#39;q&#39;
</span><span class='line'>  dfe                     delete to next &#39;e&#39; (the end of &quot;state&quot;)
</span><span class='line'>     ~                    invert case of letter under cursor (the &#39;D&#39; in &quot;Do&quot;)
</span><span class='line'>      fs                  move cursor to next &#39;s&#39; (the beginning of &quot;state&quot;)
</span><span class='line'>        df,               delete to next &#39;,&#39;
</span><span class='line'>           x              delete (the space after the &#39;,&#39;)
</span><span class='line'>            <span class="nt">&lt;enter&gt;</span>       move to beginning of next line
</span><span class='line'>                   q      stop recording
</span><span class='line'>                    2@q   replay &#39;q&#39; two times
</span></code></pre></td></tr></table></div></figure>


<p>Here I will do the same using visual mode so you can better see what&rsquo;s going
on:</p>

<p><video controls>
<source src='http://blog.erw.dk/videos/posts/vimmacro.webm' type='video/webm; codecs=vp8' />
</video></p>

<p>He and I parted ways amicably! As he said</p>

<blockquote><p>vi does seem faster in the hands of someone who&rsquo;s skilled. But it also seems
that emacs is faster in the hands of someone who isn&rsquo;t particularly skilled</p></blockquote>

<p>And that&rsquo;s probably true!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Design of Everyday Things]]></title>
    <link href="http://blog.erw.dk/2014/11/21/the-design-of-everyday-things/"/>
    <updated>2014-11-21T04:15:21+01:00</updated>
    <id>http://blog.erw.dk/2014/11/21/the-design-of-everyday-things</id>
    <content type="html"><![CDATA[<p><img class="right" src="http://blog.erw.dk/images/posts/IC3_tray_table.jpg" width="300" title="A tray table in a Danish IC3 train" alt="A tray table in a Danish IC3 train"></p>

<p>The woman in the seat next to me on the train had trouble folding down her tray table.
I showed her how to do it, and she said &ldquo;Oh, I&rsquo;ve never been good at that sort of thing.&rdquo;
I said &ldquo;It&rsquo;s not you, it&rsquo;s just bad design.&rdquo;
She didn&rsquo;t follow.
&ldquo;See, it <em>looks like</em> you&rsquo;re supposed to turn the knob, but in fact you have to slide it. You just tried to turn it like the design told you to do, but the design was wrong.&rdquo;</p>

<p>She never seemed to accept my interpretation of the situation.
But the fact is that design subconsciously guides us and affects our behavior, for better and for worse.
I hope to do a better job here of convincing you than I did with the woman in the train!</p>

<!-- more -->


<p>The concept of <em>affordance</em> is about what things <em>are for</em>.
For example, a hammer <em>affords</em> hitting.
James J. Gibson introduced the concept as the <em>possibilities for action</em> that are possible between an object and a user.
<a href="http://en.wikipedia.org/wiki/Don_Norman">Don Norman</a> later popularized the idea with a focus on what actions seem obvious (hitting with a hammer), rather that which ones are theoretically possible (say, stirring a pot with it).
He did this in his famous &mdash; and recommendable &mdash; 1988 book <a href="http://en.wikipedia.org/wiki/The_Design_of_Everyday_Things">The Design of Everyday Things</a>, from which I lifted the title as well as this quote:</p>

<blockquote><p>Affordances provide strong clues to the operations of things. Plates are for
pushing. Knobs are for turning. Slots are for inserting things into. Balls
are for throwing or bouncing. When affordances are taken advantage of, the
user knows what to do just by looking: no picture, label, or instruction
is required.</p></blockquote>

<p>When affordances and operations match, then the things we interact with work intuitively:
We flip the switch, and the light comes on.
When things <em>just work</em>, we might not even notice that affordance and operation are two separate things.
How could it be otherwise?
Well, for example, sometimes we pull a door handle, but the door doesn&rsquo;t open.
The handle affords pulling, but the door opens the other way.
It&rsquo;s when affordances and operations don&rsquo;t match that we get confused.</p>

<p><img class="right" src="http://blog.erw.dk/images/posts/tray_table_locks.png" title="Drawing of the IC3 tray lock design and a better alternative" alt="Drawing of the IC3 tray lock design and a better alternative"></p>

<p>The tray table lock in the train had a mismatch between affordance and operation.
The round hole surrounding the small plastic handle made the whole thing look like things we normally <em>turn</em>, like the knob on a stove, or a volume knob.
But it was actually meant to slide up to release the lock and let the table unfold.
Since the small handle is not as wide as the inner diameter of the circle, it is also possible to push the handle up/down.
Most users figure this out after a while.
But a rectangular shape would likely have given this association from the beginning, without the detour of trying to turn it.</p>

<p>As an example of well-matched affordance, here&rsquo;s a nice feature on my Braun shaver:
Grooves in the plastic make it look compressible, like an accordion.
The plastic isn&rsquo;t in fact compressible, but the supporting springs underneath are.
But independently of the mechanical implementation, the design speaks it&rsquo;s clear language: I&rsquo;m flexible.</p>

<p><img src="http://blog.erw.dk/images/posts/shaver.jpg" title="My groovy Braun shaver" alt="My groovy Braun shaver"></p>

<p>James J. Gibson has some <a href="http://www.trincoll.edu/depts/ecopsyc/perils/folder5/prelim.html">more examples of affordances</a>.</p>

<a name="Why.Usability.Matters"></a>
<h2>Why Usability Matters</h2>

<p>Affordance is related to <a href="http://www.nngroup.com/articles/usability-101-introduction-to-usability/">usability</a>, or, how easy and efficient things are to use.
Good use of affordance makes it easy to learn how to use something and less likely to make mistakes.
Mismatched or hidden affordances do the opposite.
We always make mistakes, but if the design is bad, we make lots more.</p>

<p>Tray tables and shavers are pretty harmless, but human perception works the same way in serious situations.
Another example of mismatched affordances comes from the 2000 United States presidential election.
The unlucky design of a ballot meant that <a href="http://en.wikipedia.org/wiki/United_States_presidential_election_in_Florida,_2000#Palm_Beach_County.27s_butterfly_ballots">Al Gore lost some votes</a> he could really have used.
Danish ballots also used to have an affordance problem, although it did not favor one candidate over another.
The problem was lack of affordance:
Ticking a box is just not very satisfying <a href="http://commons.wikimedia.org/wiki/File:Stemmesedler_2005.JPG#mediaviewer/File:Stemmesedler_2005.JPG">when there&rsquo;s no box</a>.
In addition, inattentive voters might have marked their vote with a ring around a name, thus invalidating their vote because only a cross is allowed.</p>

<p><span class='caption-wrapper left'><img class='caption' src='http://blog.erw.dk/images/posts/cockpit.jpg' width='320' height='240' alt='[Picture](http://pixabay.com/en/cockpit-kontrolpanel-466157/) by [gepardowa](http://pixabay.com/en/users/gepardowa-320124/) is licenced under [CC0](http://creativecommons.org/publicdomain/zero/1.0/)'><span class='caption-text'><a href="http://pixabay.com/en/cockpit-kontrolpanel-466157/">Picture</a> by <a href="http://pixabay.com/en/users/gepardowa-320124/">gepardowa</a> is licenced under <a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a></span></span></p>

<p>You may wonder if this isn&rsquo;t just a question of paying attention.
Or put more bluntly: A question of not being <a href="http://www.nngroup.com/articles/are-users-stupid/">stupid</a>.
To some extent, yes.
While doing something important, such as voting or controlling a nuclear power plant, it would indeed be sensible to double-check and confirm you did the right thing.
But that doesn&rsquo;t legitimize making a confusing design in the first place.
A confusing design can be a waste of time in daily life.
This is in itself annoying, but sometimes time is more critical.
For example, while controlling an airplane or that nuclear power plant, there can be stressful situations with short time to do the right thing, and no time for double-checking.
Even though pilots and operators are trained, it doesn&rsquo;t mean that they are infallible.
Humans will always make mistakes, so the tools we use should not increase the risk of errors.</p>

<p>When human life is not at stake, money is.
Usability is also part of designing an attractive product that users want to buy.
I say &ldquo;part of&rdquo; because, as Don Norman details in his later book <a href="http://en.wikipedia.org/wiki/Emotional_Design">Emotional Design</a>, usability relates to our brains&#8217; behavioral thinking, but there are two more &ldquo;brain levels&rdquo; to satisfy to make a truly successful product.
Once the product itself is good enough, its website must also have good usability and be a good overall user experience.
Jakob Nielsen, a colleague of Don Norman, is known to say that &ldquo;a bad website is like a grumpy salesperson&rdquo;.
Web usability and user experience design are fields of their own, but they are based on human cognition, just like <em>the design of everyday things</em>.</p>

<p>Once you are aware of the concept of affordance, you might start looking for it in your surroundings.
I suspect Danish people reading this might remember a more obvious usability problem in the Danish IC3 trains, besides the tray table:
The doors between compartments are sliding doors, with no handles or buttons.
This is not uncommon; automatic sliding doors typically open when we approach them.
But these don&rsquo;t do that either.
So, what do you do with products that are not self-explanatory?
Of course you <strike>fix them</strike> provide instructions!</p>

<a name="Don.t.Make.Me.Think"></a>
<h2>Don&rsquo;t Make Me Think</h2>

<p>(I noticed that Don&rsquo;t Make Me Think is also <a href="http://www.sensible.com/dmmt.html">a book about web usability</a>. I have not read it, but I fully agree with the message of its title! And it doesn&rsquo;t apply only to web usability.)</p>

<p><span class='caption-wrapper left'><img class='caption' src='http://blog.erw.dk/images/posts/pushpull.jpg' width='450' height='338' alt='[Push Pull](https://www.flickr.com/photos/russmorris/481397004/) by [Russ Morris](https://www.flickr.com/photos/russmorris/) is licensed under [CC BY-NC-ND 2.0](https://creativecommons.org/licenses/by-nc-nd/2.0/)'><span class='caption-text'><a href="https://www.flickr.com/photos/russmorris/481397004/">Push Pull</a> by <a href="https://www.flickr.com/photos/russmorris/">Russ Morris</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">CC BY-NC-ND 2.0</a></span></span></p>

<p>A classic example of usage instructions is push/pull signs on doors.
Using affordance properly, it is wholly possible to design a door where the shape and position of the handles and the design of the frame subconsciously guide us to push when and where we should push, and pull when and where we should pull.
One way is to use a handle that is easy to pull on one side, and on the other side a handle that is easier to push &mdash; possibly a plate or bar that can only be pushed.
But while it is possible, that doesn&rsquo;t mean it is always done in practice.
Maybe nobody knew.
Or maybe it was just cheaper to put the same handle on both sides.
But probably the first.
So when it is discovered that the door works poorly and people want to improve it, they add the instructions.
However, Norman writes:</p>

<blockquote><p>Complex things may require explanation, but simple things should not. When
simple things need pictures, labels, or instructions, the design has failed.</p></blockquote>

<p>But why are instructions so bad?
Or at least potentially unnecessary instructions such as push/pull signs?
One problem is that when a task requires us to read and think more than what is necessary, it distracts us from thinking about more important or urgent matters.
This is especially important in those stressed situations, I have already mentioned.
But reading is also harder than picking up clues from physical shapes.
Our brains have evolved and adapted to a tangible environment, and reading is relatively new, and not as &ldquo;efficiently implemented&rdquo;.</p>

<p>But it turns out all instructions are not equally bad.
Here&rsquo;s a door I came across in the Gromada Airport Hotel in Warsaw:</p>

<p><img src="http://blog.erw.dk/images/posts/gromada.jpg" title="Hotel Gromada push&#47;pull doors signs" alt="Hotel Gromada push&#47;pull doors signs"></p>

<p>I think the 3D effect of the arrows can actually help speak directly to our spatial intelligence, bypassing the need for reading and language processing.
(Of course it helps that I don&rsquo;t read Polish!)
I think if the text was removed, the arrows might work as well as well placed door handles, if not as elegantly.
But I&rsquo;m probably too conscious about these subconscious things to be a good judge.
It would be up to user testing to tell.</p>

<p>While instructions are typically employed to meet the lack of affordance, they can also be used when there&rsquo;s <em>unwanted</em> affordance:</p>

<p><img src="http://blog.erw.dk/images/posts/dont_push.jpg" title="A don&#39;t push sign on a revolving door" alt="A don&#39;t push sign on a revolving door"></p>

<p>(This particular revolving door at the NH Utrecht hotel was however spinning so fast I had a hard time seeing why anyone would feel the need to push it.
I think it shows in my blurry picture.)</p>

<p>Of course, most rule signs follow from some action being afforded by the environment, but deemed unwanted.
Some rules are perhaps better enforced by removing the affordance.
For example, a <a href="http://www.citylab.com/design/2014/10/why-12-foot-traffic-lanes-are-disastrous-for-safety-and-must-be-replaced-now/381117/">narrow</a> or curvy road does not afford driving at high speed.
(Neither do roads with speed bumps, because the bumps afford unpleasant bouncing and perhaps damaging the car.)</p>

<p><img class="right" src="http://blog.erw.dk/images/posts/microfridge.jpg" width="350" title="A usable microwave oven" alt="A usable microwave oven"></p>

<p>We already established that it&rsquo;s better to guide the user with affordance than with instructions, but some things may be too complex to rely solely on affordance.
In those cases we might be asked to read instruction manuals instead of a single pictogram or sentence.
However, that doesn&rsquo;t remove the problems with instruction: They stand between us and what we want to do.</p>

<p>So the less the text, the better.
Case in point, here is a microwave oven that I think most people could use without a manual.
(It&rsquo;s just a pity that the brand name MicroFridge could suggest the device is a fridge!
Alas, it probably doesn&rsquo;t matter anyway, because&hellip;)</p>

<p>The biggest problem with instructions is that, most of the time, <em>people don&rsquo;t read instructions</em>!</p>

<p>This is why affordance was important in the first place, along with many other concepts related to usability such as <a href="http://www.nngroup.com/articles/mental-models/">mental models</a> and feedback to the user about the state of the system.</p>

<p><img class="left" src="http://blog.erw.dk/images/posts/hisf.jpg" title="An empathetic elevator sign" alt="An empathetic elevator sign"></p>

<p>Finally, an example that you can even have bad usability and still make your users (at least the ones who read!) walk away with a smile.
I found it next to the elevator in the HI-San Francisco Downtown hostel.
(The quality of the signage in that place <em>almost</em> made up for the quality of the breakfast!)</p>

<p>In conclusion, products that are compatible with our brains&#8217; autopilots work really well.
Part of achieving that is matching affordance to the functionality of the product.
This attention to detail is the difference between something that simply functions and something that really <em>works</em>.</p>

<p>I have presupposed that the products do function correctly.
This is of course far from always the case, especially in complex systems.
In fact, the field I do my PhD in, <a href="http://en.wikipedia.org/wiki/Formal_methods">formal methods</a>, is exactly about proving that complex computer controlled systems function as they are supposed to.
This in itself can require an enormous effort, but as we have seen in this post, correct functioning should be matched by good usability.</p>

<p><em>Except where it says otherwise, the
<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/StillImage" rel="dct:type">images on this post</span> are by me, <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Erik Ramsgaard Wognsen</span>, and you may reuse them under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Essence of vi]]></title>
    <link href="http://blog.erw.dk/2014/10/31/the-essence-of-vi/"/>
    <updated>2014-10-31T09:49:46+01:00</updated>
    <id>http://blog.erw.dk/2014/10/31/the-essence-of-vi</id>
    <content type="html"><![CDATA[<p><a href="http://www.vim.org/about.php">Vim</a> is a popular and widely distributed text editor improving on the
legendary <a href="http://en.wikipedia.org/wiki/Vi">vi</a> from the late 1970s.  If you are reading this on Mac or
Linux, chances are that Vim is already installed on your computer, included
with your OS.  If you tried Vim and found it too strange to use, or if you use
it but still harbor the idea that it was made by (or for!) aliens, you&rsquo;ve come
to the right place!</p>

<p>Vim is a very powerful tool, but often misunderstood.  There are plenty of
tutorials that go through the basics, but they usually fail to paint the big
picture.  <em>Why</em> the weird keyboard shortcuts, and the modes?  Why is it
worthwhile to learn?  In this post I will try to answer these questions.  And
I am pleased to say that the answer doesn&rsquo;t start with <em>h</em>, <em>j</em>, <em>k</em>, <em>l</em>, or
<em>i</em>.</p>

<p>Instead of the traditional bottom-up tutorial, this will be a top-down
introduction, that uncovers to the <em>essence of vi</em> and the almost poetic
language you use to speak to Vim and vi.  It is my hope that reading it will
make your time with Vim both more useful and more enjoyable.  I have myself
enjoyed Vim since 2007, and I also <a href="https://code.google.com/p/vim/source/browse/runtime/syntax/asm.vim">contribute a tiny bit</a> to it.</p>

<!-- more -->




<div id="toc">
<ul>
 <li>
 <ul>
  <li><a href="#Don.t.Worry.About.Modes">Don&#8217;t Worry About Modes</a></li>
  <li><a href="#Play.with.the.Gamepad">Play with the Gamepad</a></li>
  <li><a href="#The.Language.of.vi">The Language of vi</a>
  <ul>
   <li><a href="#Verbs">Verbs</a></li>
   <li><a href="#Nouns.Objects">Nouns/Objects</a></li>
   <li><a href="#Prepositional.Phrases.Motions">Prepositional Phrases/Motions</a></li>
   <li><a href="#Numerals">Numerals</a></li>
  </ul>
  </li>
  <li><a href="#Expand.your.Vocabulary">Expand your Vocabulary</a></li>
  <li><a href="#Real.Keyboard.Shortcuts">Real Keyboard Shortcuts</a></li>
  <li><a href="#What.about.Usability.">What about Usability?</a></li>
  <li><a href="#Conclusion">Conclusion</a></li>
 </ul>
 </li>
</ul>


</div>


<a name="Don.t.Worry.About.Modes"></a>
<h2>Don&rsquo;t Worry About Modes</h2>

<p>In Adobe Photoshop, pressing <code>L</code> selects the lasso tool, and <code>M</code> the marquee
tool.  Photoshop has many tools and functions, and there are many letters on
the keyboard &mdash; good.  But for most writing applications and text editors, the
letter keys are used for typing.  In these programs (and Photoshop), keyboard
shortcuts use modifiers, for example <code>ctrl-s</code> to save changes.  This means that
prime keyboard real estate is not used to its fullest.  50+ easy-to-press
shortcuts &mdash; upper and lower case letters &mdash; are only used for a single
purpose.</p>

<p>A different approach to text editing is <em>modal editing</em>.  Here the &ldquo;typing
mode&rdquo; is just one of several modes of using the editor (and thus the keyboard).
It is distinct from the mode(s) wherein you move the cursor, copy, paste, etc.
Notably, it often makes sense that the typing mode, or insert mode as it is
commonly called, is <em>not the default mode</em>.  The reason is that it is far more
common to edit, write, and program incrementally, than it is to write a piece
from start to finish.  You navigate around the text to read, think, make small
adjustments, and enter a few words, sentences, or statements at a time.</p>

<p>Vim has many modes, with <em>normal</em> (&ldquo;command&rdquo;) mode and <em>insert</em> mode being the
two main modes.  Now, I could enumerate all the modes, their roles, and how to
switch between them, but I&rsquo;m not going to.  Because when you use Vim naturally,
you don&rsquo;t think about modes, you think about <em>actions</em>.  And the actions lead
you naturally to the mode changes.  Think about finding content on a web page
in your browser: You press <code>ctrl-f</code> which opens a text field.  Here you write
you search string, press <code>&lt;enter&gt;</code> a few times, then <code>&lt;esc&gt;</code> when you&rsquo;re done.
You just used FIND MODE!  (It was super effective!)</p>

<p>Modal editing simply gives you more buttons for actions.  As
<a href="http://www.viemu.com/a-why-vi-vim.html">Jon Beltran de Heredia wrote</a>:</p>

<blockquote><p>with vi, your keyboard becomes a huge specialized text-editing gamepad with
almost a hundred buttons.</p></blockquote>

<a name="Play.with.the.Gamepad"></a>
<h2>Play with the Gamepad</h2>

<p>It can be hard to separate what you usually do with a text editor from what you
want to do with <em>the text</em>.  Learning Vim, you might ask &ldquo;How do I select all
text?&rdquo; After all, in most editors, this is a simple <code>&lt;c-a&gt;</code> (this is another
way of writing <code>ctrl-a</code>).  I could tell you how to do it in Vim (one way is
<code>ggVG</code>), but it is not in the spirit of vi.  In fact, it&rsquo;s not even possible in
vi.  And <em>to master Vim, you must understand vi</em>.  (In a later post I will
cover some &ldquo;philosophical&rdquo; differences between Vim and vi. <em>Update 2014-11-25:
<a href="http://blog.erw.dk/2014/11/25/the-language-of-vi-improved/">Here it is!</a></em>) Instead, realize that
selecting text is a means, but to what end?  <em>Why</em> you want to select all?</p>

<p>Do you want to copy everything?  Then copy, don&rsquo;t select.  It&rsquo;s &ldquo;<code>ggyG</code>&rdquo;. Type
it one letter at a time, and pay attention to case.  What does it mean?  The
<code>gg</code> part moves the cursor to the first line, <code>y</code> then <em>yanks</em> (copies) every
line until (and including) <code>G</code>, the last line.  vi is older than the
standardized cut, copy, and paste, hence the name &ldquo;yank&rdquo;.</p>

<p>Now, if you would think <code>ggyG</code> is no faster than <code>&lt;c-a&gt;&lt;c-c&gt;</code> (select all,
copy) in a regular editor, you&rsquo;d be right.  But say you wanted to copy just
a paragraph?  Type <code>yap</code> to &ldquo;yank a paragraph&rdquo;, with the cursor anywhere in
that paragraph.  Or copy an HTML/XML element? Go ahead and &ldquo;yank a tag-block&rdquo;,
<code>yat</code>.  Then <em>put</em> (paste) three copies of it: <code>3P</code>.  And change the content
(of whichever one you put the cursor on): <code>cit</code> (&ldquo;change inner tag-block&rdquo;).</p>

<p>This last command is slightly different from the others.  It deletes the
content of the element, then drops you to insert mode with the cursor inside
the element, i.e. <code>&lt;foo bar="baz"&gt;</code>between the tags<code>&lt;/foo&gt;</code>.  Then you type
your new content, followed by <code>&lt;esc&gt;</code>, which returns you to normal mode,
simultaneously completing the action.  It might go like this, from start to
finish:  <code>citMy new content&lt;esc&gt;</code>.</p>

<p>Then move to another element and type <code>.</code> to repeat the action!</p>

<p>In
<a href="http://jeetworks.org/grokking-the-zen-of-the-vim-wu-wei/">the words of Jeet Sukumaran</a>:</p>

<blockquote><p>It seemed that, without my hands leaving the keyboard, just a few strokes
here and a few taps there, I was capable of dancing all over the document,
and perform everything from extremely precise [targeted] micro-surgery to
massive document-wide renovations.</p></blockquote>

<a name="The.Language.of.vi"></a>
<h2>The Language of vi</h2>

<p>Mode changes take time to get accustomed to.  They are very visible and
&ldquo;demanding&rdquo; the first many times you use a modal editor.  Hence, they get a lot
of attention.  But too often they steal the attention from the more important
concept of actions.</p>

<p><a href="http://stackoverflow.com/questions/1218390/what-is-your-most-productive-shortcut-with-vim/1220118#1220118">People</a>
<a href="http://yanpritzker.com/2011/12/16/learn-to-speak-vim-verbs-nouns-and-modifiers/">have</a>
<a href="http://stevelosh.com/blog/2010/09/coming-home-to-vim/#a-language-of-text-editing">described</a>
Vim/vi as having a language of editing.  Perhaps you already got the feeling
from the mnemonics above such as &ldquo;yank a paragraph&rdquo;.  The language of vi is how
you instruct the editor to perform actions.  One action is one sentence, and
a sentence consists of verbs, nouns, etc.  Here I will pursue the idea with
a bit more systematically than the aforementioned sources.</p>

<p>There are four possible sentences types/word orders:</p>

<ul>
<li>Verb</li>
<li>Verb Object</li>
<li>Verb [Prepositional Phrase]</li>
<li>[Prepositional Phrase]</li>
</ul>


<p>We shall explore the components of these sentences below, along with what it
means for a
<a href="http://en.wikipedia.org/wiki/Adpositional_phrase#Prepositional_phrases">prepositional phrase</a>
(e.g., &ldquo;to &hellip;&rdquo;, &ldquo;until &hellip;&rdquo;) to stand alone.  The subject is always the
implied &ldquo;you&rdquo; in the imperative.  We are commanding the editor, after all!</p>

<a name="Verbs"></a>
<h3>Verbs</h3>

<p>We have already seen verbs like yank <code>y</code>, change <code>c</code>, put <code>P</code>, and repeat <code>.</code>.
Verbs fall into two categories:  The first type has its &ldquo;area of effect&rdquo;
implied and the change will occur immediately:</p>

<ul>
<li><em>put</em> previously yanked or deleted text <code>P</code></li>
<li><em>repeat</em> last action in a new context <code>.</code></li>
<li><em>delete</em> a single character backwards <code>X</code></li>
<li><em>swap</em> case of a single character <code>~</code></li>
<li><em>insert</em> text <code>i</code></li>
<li><em>replace</em> text <code>R</code></li>
</ul>


<p>The second type is the
<a href="http://vimdoc.sourceforge.net/htmldoc/motion.html#operator"><em>operator</em></a> which
includes commands such as</p>

<ul>
<li>yank <code>y</code></li>
<li>change <code>c</code></li>
<li>delete <code>d</code></li>
<li>increase/decrease indentation <code>&gt;</code> <code>&lt;</code></li>
<li>make UPPER/lower/opposite case <code>gU</code> <code>gu</code> <code>g~</code></li>
</ul>


<p>The difference between &ldquo;immediate changes&rdquo; and operators is that when you type an
operator, the editor awaits the object or region that the operator should
affect.  This role is played by nouns and prepositional phrases.</p>

<p>There are many more verbs, and you indeed need more to use vi (and therefore
Vim) efficiently, but this selection will do fine in explaining the language
metaphor.  It&rsquo;s expected and normal that you find the commands hard to remember
at first.  But if you are curious and/or adamant enough to learn them, they
grow into muscle memory, and you reap the full benefits of the compactness and
efficiency.
<a href="http://pascalprecht.github.io/2014/03/18/why-i-use-vim/">Paraphrasing Pascal Precht</a>:</p>

<blockquote><p>Vim&rsquo;s learning curve is not a curve at all. It&rsquo;s a wall. But once you climb
that wall, you can lean back and slide down on the other side.  Once I was
able to do some basic operations in Vi, I made almost as twice as much
progress at work in about half the time.</p></blockquote>

<p>(If you want some tips on how to edit text better (not just in Vim) and do more
in the same amount of time, Bram Moolenaar, the creator of Vim, has
<a href="https://www.youtube.com/watch?v=p6K4iIMlouI">7 Habits For Effective Text Editing</a>.)</p>

<p>Verbs from both categories (immediate and operators) can involve a mode change.
The insert <code>i</code> and change <code>c</code> commands both switch to insert mode where you can
enter the new text.  The replace <code>R</code> command uses <em>replace mode</em>, which is
similar to insert mode, except you replace (overwrite) text as you type.  (This
is maybe another mode you already knew &ndash; in Microsoft Word and other
<a href="http://en.wikipedia.org/wiki/Word_processor">word processors</a>, it&rsquo;s toggled by the <code>&lt;insert&gt;</code> key.) Operators (as
opposed to immediate changes) in fact always incur mode a change: After typing
the operator, the editor will be in <em>operator pending mode</em>, awaiting the
choice of the text to operate on.  We will see how to choose that text in the
next two sections.</p>

<a name="Nouns.Objects"></a>
<h3>Nouns/Objects</h3>

<p>We have seen nouns such as a paragraph <code>ap</code> and a tag block <code>at</code>.  There are
others such as a word <code>aw</code>, a sentence <code>as</code>, and various blocks (delimited by
 <span class="nobreak"><code>{}</code>,</span>
 <span class="nobreak"><code>()</code>,</span>
 <span class="nobreak"><code>&lt;&gt;</code>,</span>
 <span class="nobreak"><code>[]</code>,</span>
 <span class="nobreak"><code>""</code>,</span>
 <span class="nobreak"><code>''</code>,</span>
 <span class="nobreak">and <code>``</code></span>).
Nouns, or <a href="http://vimdoc.sourceforge.net/htmldoc/motion.html#text-objects">text objects</a> as they are called in Vim, must be prefixed
with an <code>a</code> or <code>i</code>.  Above I showed them with <code>a</code> to help as a mnemonic (&ldquo;a
paragraph&rdquo; ~ <code>ap</code>).  The &ldquo;article&rdquo; serves two purposes: First, it distinguishes
the nouns from <em>prepositional phrases</em> that are bound to the same letter (&ldquo;a
word&rdquo; <code>aw</code>, for example, is not the same as <code>w</code> which means &ldquo;<em>to/until the
next</em> word&rdquo;, as we shall see in the next section).  Second, it marks whether
the whole object (<code>a</code>) or only its &ldquo;insides&rdquo; (<code>i</code>) are meant.  For example, we
have seen <code>yat</code> yank a whole tag block, while <code>cit</code> changes its contents (i.e.,
not the enclosing tags).  For objects that do not have an obvious crunchy shell
surrounding a soft, chewy center, the <code>a</code> version includes the trailing
whitespace while <code>i</code> doesn&rsquo;t.  Thus, <code>a</code> is useful for transplanting words and
sentences without having to clean up the whitespace afterwards.</p>

<p>Text objects are &ldquo;intelligent&rdquo;.  First, they are insensitive to the cursor
position within the text object: The whole object (or its inside) is used as
long as the cursor is somewhere inside it.  Second, they can depend on context:
The meaning of &ldquo;a word&rdquo; depends on the file type.  In C-style programming
languages, dashes are not part of a word, but in Lisps, they are.  For prose
writing, I have set Vim up to see apostrophes as parts of words such that
&ldquo;can&rsquo;t&rdquo; is seen as a single word (which would not be so useful in programming).
Paragraph boundaries can similarly be specified.  Strings are aware of escaped
quote characters.  For example, <code>"This is one \"string\""</code>.</p>

<p>I didn&rsquo;t mention &ldquo;line&rdquo; as a noun.  This is not because operating on lines is
uncommon, in fact it&rsquo;s the opposite.  Repeating an operator symbol makes the
operator work on the current line:
 <span class="nobreak"><code>yy</code>,</span>
 <span class="nobreak"><code>cc</code>,</span>
 <span class="nobreak"><code>dd</code>,</span>
 <span class="nobreak"><code>&gt;&gt;</code>,</span>
 <span class="nobreak"><code>&lt;&lt;</code>,</span>
 <span class="nobreak"><code>gUU</code>,</span>
 <span class="nobreak"><code>guu</code>,</span>
 <span class="nobreak"><code>g~~</code>,</span>
&hellip;</p>

<a name="Prepositional.Phrases.Motions"></a>
<h3>Prepositional Phrases/Motions</h3>

<p>There are also
<a href="http://en.wikipedia.org/wiki/Adpositional_phrase#Prepositional_phrases">prepositional phrases</a>,
which is the grammatical term I use for what Vim calls
<a href="http://vimdoc.sourceforge.net/htmldoc/motion.html#cursor-motions">cursor motions</a>.
We have already seen &ldquo;to the first line&rdquo; and &ldquo;to the last line&rdquo;, <code>gg</code> and <code>G</code>,
respectively.  The sequence <code>ggyG</code> we saw earlier reads as two sentences:
&ldquo;(First,) (go) to the first line of the buffer.  (Then) yank until the last
line.&rdquo;  This demonstrates an important point:
There is no need for punctuation in the &ldquo;vi language&rdquo; (at least figuratively
speaking!) because the word order is enough: A prepositional phrase without
a verb is taken to be a cursor movement command.  A prepositional phrase
following an operator verb means that the operator should act on the text
<em>from</em> the current cursor position and <em>to</em> wherever the motion leads.
(Here you can see that this is really a top-down introduction to Vim.
A tutorial would probably have told you first thing how to move the cursor!)</p>

<p>First, let&rsquo;s see some word motions:</p>

<ul>
<li>&ldquo;to the next beginning-of-a-word&rdquo; <code>w</code></li>
<li>&ldquo;(backwards) to the previous beginning-of-a-word&rdquo; <code>b</code></li>
<li>&ldquo;to the next/previous end-of-a-word&rdquo; <code>e</code> and <code>ge</code></li>
</ul>


<p>Unlike text objects such as &ldquo;a word&rdquo; <code>aw</code>, motions use your exact cursor
position as the point of origin.  Therefore, <code>b</code> and <code>e</code> will find the
beginning/end of the word the cursor is inside, unless you are already on the
beginning/end.  If you <em>are</em> on the beginning or end, they will move to the
previous or next word, respectively.  Notice that I say <em>on</em>.  In Vim/vi, the
cursor moves <em>on</em> characters, not between them as in many other editors.</p>

<p>If you move back and forth in a sentence using <code>b</code> and <code>w</code> you can exploit the
fact that the cursor is always on the first character of a word.  For example,
<code>dw</code> deletes a word without the need for <code>daw</code>.  The motions <code>(</code> and <code>)</code> work
like <code>b</code> and <code>w</code> but for sentences.  The motions <code>{</code> and <code>}</code> go to the
previous/next paragraph boundary.</p>

<p>Another powerful type of motion is the &ldquo;till&rdquo;/&ldquo;find&rdquo; motion. Till <code>t</code> moves to
the next character you specify.  For example, <code>t"</code> moves to right before the
next <code>"</code> in the line.  Find <code>f</code> is similar, except it moves onto the specified
character.  The motion <code>;</code> repeats the last <code>t</code> or <code>f</code> motion.  All three
motions have equivalents going to the left instead of right: <code>T</code>, <code>F</code> and <code>,</code>.</p>

<p>The till/find motions are for quick and simple jumps within the same line.
<a href="http://en.wikipedia.org/wiki/Regular_expression">Regex</a> search finds anything, anywhere in the file.  The commands <code>/</code>
and <code>?</code> open up a search field for forward and backward regex search,
respectively.  It even highlights the first match while you type to give you
live feedback on your search pattern.  After confirming the entered pattern
with <code>&lt;enter&gt;</code>, keys <code>n</code> and <code>N</code> jump in the same/opposite direction of the
current regex search.</p>

<p>Coming from other text editors, it&rsquo;s easy to think that <code>/</code> is &ldquo;just&rdquo; how you
search for text.  And it is.  But the four commands <span class="nobreak"><code>/</code>
<code>?</code> <code>n</code> <code>N</code></span> are all motions, and like any motion they can be used alone
or with an operator.  The design of vi is <a href="http://en.wikipedia.org/wiki/Orthogonality#Computer_science">orthogonal</a>:  You can learn
it piece by piece, and combine the new motion you just learned with the verbs
you already knew and vice versa.  This is extremely powerful and part of what
makes vi/Vim so special.  The idea may be almost 40 years old, but
<a href="https://medium.com/@mkozlows/why-atom-cant-replace-vim-433852f4b4d1">it&rsquo;s still relevant today and in the future</a>!</p>

<p>You may have noticed I didn&rsquo;t mention the most basic motions you already know
from your arrow keys.  Many Vim introductions (including the official
&ldquo;vimtutor&rdquo;) mention very early on that <span class="nobreak"><code>h</code> <code>j</code> <code>k</code> <code>l</code>
</span> work as <span class="nobreak">&#8592; &#8595; &#8593; &#8594;</span>,
respectively.  And people wonder why they can&rsquo;t just use the normal arrow keys.
But either kind of arrow keys are beside the point!  There&rsquo;s almost always
a smarter way &mdash; a more precise motion &mdash; to go somewhere than to hold down
arrow keys.  <a href="http://jeetworks.org/vim-making-those-arrow-keys-work-for-you-or-why-the-anti-arrow-key-propoganda-is-wrong/">Jeet Sukumaran tells it</a> again:</p>

<blockquote><p>being forced to use the rich suite of powerful normal mode movement commands
to get to exactly where I needed to be [&hellip;] was like
suddenly beginning to use the fifth and other gears while driving on an open
highway, whereas before I had been grinding along for mile after laborious
mile on first.</p></blockquote>

<p>Here are some more motions just to illustrate:</p>

<ul>
<li>&ldquo;to the matching parenthesis/brace/comment marker/HTML tag/if/else-stmt/etc. <code>%</code></li>
<li>&ldquo;to the next/previous misspelled word&rdquo; <code>]s</code> <code>[s</code></li>
<li>&ldquo;to the next/previous start/end of a method (Java/C# style) <code>]m</code> <code>]M</code> <code>[m</code> <code>[M</code></li>
</ul>


<a name="Numerals"></a>
<h3>Numerals</h3>

<p>So far we have covered verbs, nouns, and prepositional phrases. Let&rsquo;s look at
numerals, of which vi uses three types:</p>

<ul>
<li>Cardinal numbers, e.g., 1, 2, 7</li>
<li>Adverbial numbers, e.g., once, twice, sevenfold</li>
<li>Ordinal numbers, e.g. 1st, 2nd, 7th</li>
</ul>


<p>The grammatical distinction is mine; in vi they&rsquo;re all known as <em>counts</em>.  But
it helps to show the different roles counts have.
Cardinal numbers (1, 2, 7) can choose the number of lines to apply an operator
to, or the number of text objects (nouns) to apply an operator to:</p>

<ul>
<li>&ldquo;Indent ten lines&rdquo; <code>10&gt;&gt;</code></li>
<li>&ldquo;Uppercase two sentences&rdquo; <code>gU2as</code></li>
</ul>


<p>Adverbial numbers (once, twice, sevenfold) can decide the number of times to
do something:</p>

<ul>
<li>&ldquo;Twentyfold insert a blank line&rdquo; <code>20i&lt;enter&gt;&lt;esc&gt;</code> (-> &ldquo;Insert 20 blank
lines&rdquo;)</li>
<li>&ldquo;Delete until you have moved twice to the next word&rdquo; <code>d2w</code> (-> &ldquo;Delete two
words&rdquo;)</li>
</ul>


<p>Ordinal numbers (1st, 2nd, 7th) can choose where to go:</p>

<ul>
<li>&ldquo;To the 27th line&rdquo; <code>27gg</code></li>
<li>&ldquo;To the 20000th byte&rdquo; <code>20000go</code></li>
<li>&ldquo;To the 80&#8217;th column&rdquo; <code>80|</code></li>
<li>&ldquo;To the 70%&lsquo;th line&rdquo; <code>70%</code></li>
</ul>


<p>The ordinal numbers can also be though of just as cardinals (line 27 = 27th
line), but since they access ordered items, it makes sense to see them as
ordinals.</p>

<p>All motions and operators in fact take a count, but it usually defaults to 1.
This is another example of orthogonality in vi.</p>

<a name="Expand.your.Vocabulary"></a>
<h2>Expand your Vocabulary</h2>

<p>For even more orthogonality, you can even add verbs and nouns, as
<a href="http://yanpritzker.com/2011/12/16/learn-to-speak-vim-verbs-nouns-and-modifiers/">mentioned by Yan Pritzker</a>:</p>

<ul>
<li>Install Drew Niel&rsquo;s
<a href="https://github.com/nelstrom/vim-textobj-rubyblock">textobj-rubyblock</a>
plugin to get the new noun &ldquo;Ruby block&rdquo; <code>r</code>.</li>
<li>Install Tim Pope&rsquo;s <a href="https://github.com/tpope/vim-surround">surround.vim</a>
plugin to get three new verbs:

<ul>
<li>&ldquo;Surround with&rdquo;, which is even HTML aware (closes tags). Example:

<ul>
<li>&ldquo;(you) surround a word with em-tags <code>ysaw&lt;em&gt;</code></li>
</ul>
</li>
<li>&ldquo;Change surroundings&rdquo;, example:

<ul>
<li>&ldquo;change the nearest surrounding single quotes to double quotes&rdquo; <code>cs'"</code></li>
</ul>
</li>
<li>&ldquo;Delete surroundings&rdquo;, e.g.

<ul>
<li>&ldquo;delete the nearest surrounding asterisks&rdquo; <code>ds*</code></li>
</ul>
</li>
</ul>
</li>
</ul>


<a name="Real.Keyboard.Shortcuts"></a>
<h2>Real Keyboard Shortcuts</h2>

<p>The key <code>y</code> is not a shortcut for yank, it <em>is</em> the yank operator.  But vi
still has shortcuts (in the traditional sense of the word) for those actions
that are so common that having a shorter ways to get to them is useful:</p>

<ul>
<li>&ldquo;Delete left/right&rdquo; <code>dh</code> and <code>dl</code> are <code>X</code> and <code>x</code> (think backspace and
delete)</li>
<li>&ldquo;Change to the end of the line&rdquo; <code>c$</code> is <code>C</code></li>
<li>&ldquo;Delete to the end of the line&rdquo; <code>d$</code> is <code>D</code></li>
</ul>


<p>Recall that <code>$</code> means &ldquo;to the end of the line&rdquo;.  Similarly, <code>0</code> means &ldquo;to the
beginning of the line&rdquo; and <code>^</code> means &ldquo;to the first non-blank character on the
line&rdquo;. With these we get:</p>

<ul>
<li>&ldquo;Insert at the &#8220;beginning&rdquo; of the line&#8221; <code>^i</code> is <code>I</code></li>
<li>&ldquo;Really insert at the beginning of the line!&rdquo; <code>0i</code> is <code>gI</code></li>
<li>&ldquo;Append to the line&rdquo; <code>$a</code> is <code>A</code>  (append <code>a</code> is like insert <code>i</code>
except it inserts <em>after</em> the cursor position)</li>
</ul>


<p>The idea that &ldquo;vi is about pressing <code>i</code> to insert text&rdquo; is wrong.  We have
already seen that it takes focus away from what vi is really about, namely
actions.  But it&rsquo;s also wrong because it takes focus away from the above
insertion commands which are just as common as <code>i</code> for the effective user.  For
programmers, one type of action is even more common:</p>

<ul>
<li>&ldquo;Open a new line below&rdquo; <code>o</code></li>
<li>&ldquo;Open a new line above&rdquo; <code>O</code></li>
</ul>


<p>It inserts a blank line and leaves you in insert mode, ready to type a new
statement in your program.  With Vim&rsquo;s indentation features this even starts
inserting at the right indentation level, aware of nesting and control
structures. For example, if the previous line is an &ldquo;if&rdquo; statement or the start
of a new block, the next line&rsquo;s indentation level should be one higher.</p>

<a name="What.about.Usability."></a>
<h2>What about Usability?</h2>

<p>I figure I should mention usability because there could seem to be a conflict
between these two facts: (1) I care about usability, and (2) vi is definitely
not known to be user friendly. How can I reconcile this?  The thing to remember
is that usability is about more than user friendliness.  Using the first two
components of <a href="http://www.nngroup.com/articles/usability-101-introduction-to-usability/">Jakob Nielsen&rsquo;s definition of usability</a>:</p>

<ul>
<li><em><strong>Learnability</strong>: How easy is it for users to accomplish basic tasks the first time they encounter the design?</em></li>
<li><em><strong>Efficiency</strong>: Once users have learned the design, how quickly can they perform tasks?</em></li>
</ul>


<p>This is the fundamental trade-off with Vim/vi: Very hard to master and very
efficient when mastered.  The question then quickly arises: Can learnability be
improved without harming efficiency?  And what other options exist on the
learnability/efficiency plane?  (And what about the other aspects of
usability?)  These are all interesting topics for another time!  In the
meantime I hope the <a href="http://www.nngroup.com/articles/mental-models/">mental model</a> of vi explained in this post will
make, if not your first, then your next encounter with Vim more meaningful.</p>

<a name="Conclusion"></a>
<h2>Conclusion</h2>

<p>The essence of vi is not modality.  The essence of vi is performing actions on
text.  Actions are specified using an extensible and orthogonally composable
&ldquo;language&rdquo;, where the same motions that are part of actions are also used for
plain cursor movement.  Some of the actions involve mode switching, some don&rsquo;t.
The actions drive the editing process while the modes help put a large
vocabulary right under your fingertips.</p>

<p>I have only covered basic text manipulation, though Vim does much more.  Any
user would need to know how to open/close/save files, and maybe
open/close/switch buffers, windows, and tabs (Vim has them all).  Fancier
features include regex substitution, autocompletion, diff mode, scripting, key
remapping, (mutually recursive) macros, persistent undo, and encryption.</p>

<p>These features add tremendously to the usefulness of Vim.  And regex
substitution predates even vi.  But in my opinion they are not part of its
essence, action based editing.  In fact, I barely touched upon the
command-line/Ex mode.  Most people who have tried Vim know it because it is the
one you enter when you type <code>:w&lt;enter&gt;</code> to save and <code>:q&lt;enter&gt;</code> to quit.</p>

<p>Is command-line mode essential?
Maybe <a href="http://blog.sanctum.geek.nz/vim-koans/">the Vim Koan &ldquo;The superior editor&rdquo;</a> will enlighten you.</p>
]]></content>
  </entry>
  
</feed>
